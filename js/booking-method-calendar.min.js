function bookacti_set_calendar_up(b,e){e=e?1:0;var a=b.attr("id");var d=b.find(".bookacti-calendar:first");d.fullCalendar({header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},locale:bookacti_localized.current_lang_code,defaultView:"agendaWeek",weekNumbersWithinDays:1,allDaySlot:false,allDayDefault:false,fixedWeekCount:false,contentHeight:"auto",editable:false,droppable:false,eventDurationEditable:false,showNonCurrentDates:false,eventLimit:2,eventLimitClick:"popover",dragRevertDuration:0,slotDuration:"00:30",minTime:"08:00",maxTime:"20:00",views:{week:{eventLimit:false},day:{eventLimit:false},listDay:{buttonText:bookacti_localized.calendar_button_list_day},listWeek:{buttonText:bookacti_localized.calendar_button_list_week},listMonth:{buttonText:bookacti_localized.calendar_button_list_month},listYear:{buttonText:bookacti_localized.calendar_button_list_year}},events:function(j,f,h,i){var g=[];i(g)},viewRender:function(f){},eventRender:function(j,h,f){h.data("event-id",j.id);h.attr("data-event-id",j.id);h.data("event-start",j.start.format("YYYY-MM-DD HH:mm:ss"));h.attr("data-event-start",j.start.format("YYYY-MM-DD HH:mm:ss"));h.data("event-end",j.end.format("YYYY-MM-DD HH:mm:ss"));h.attr("data-event-end",j.end.format("YYYY-MM-DD HH:mm:ss"));h.data("activity-id",j.activity_id);h.attr("data-activity-id",j.activity_id);j.render=1;if(f.name.indexOf("basic")>-1||f.name.indexOf("month")>-1){h.find("span.fc-time").text(j.start.format("HH:mm")+" - "+j.end.format("HH:mm"))}j.bookings=bookacti_get_event_number_of_bookings(j,a);if(j.bookings!=null&&j.availability!=null){var k=bookacti_is_event_available(b,j);if(!k){h.addClass("bookacti-event-unavailable")}var g=bookacti_get_event_availability_div(b,j);h.append(g)}if(f.name==="month"||f.name==="basicWeek"||f.name==="basicDay"){var i=$j("<div />",{"class":"fc-bg"});h.append(i)}if(j.repeat_freq){if(j.repeat_freq!=="none"){if(bookacti.booking_system[a]["exceptions"]!==undefined&&bookacti.booking_system[a]["exceptions"][j.id]!==undefined){$j.each(bookacti.booking_system[a]["exceptions"][j.id],function(l,m){if(m.exception_type==="date"&&m.exception_value===j.start.format("YYYY-MM-DD")){j.render=0}})}}}b.trigger("bookacti_event_render",[j,h,f]);if(!j.render){return false}},eventAfterRender:function(h,g,f){bookacti_add_class_according_to_event_size(g)},eventAfterAllRender:function(f){$j.each(bookacti.booking_system[a]["picked_events"],function(g,h){d.find('.fc-event[data-event-id="'+h.id+'"][data-event-start="'+h.start+'"]').addClass("bookacti-picked-event")});bookacti_refresh_picked_events_on_calendar(b)},eventClick:function(h,g,f){bookacti_event_click(b,h)}});bookacti_update_calendar_settings(d,bookacti.booking_system[a]["settings"]);var c=false;if(bookacti.booking_system[a]["events"]["single"].length||bookacti.booking_system[a]["events"]["repeated"].length){c=true}if(!e&&c){bookacti_fill_calendar_with_events(b)}else{if(e){bookacti_fetch_events(b)}else{if(!c){bookacti_add_error_message(b,bookacti_localized.error_no_events_bookable)}}}d.off("click",".fc-more").on("click",".fc-more",function(){bookacti_refresh_picked_events_on_calendar(b)});b.off("bookacti_pick_event").on("bookacti_pick_event",function(g,f){bookacti_pick_event_on_calendar($j(this),f)});b.off("bookacti_unpick_event").on("bookacti_unpick_event",function(h,g,f){bookacti_unpick_event_on_calendar($j(this),g,f)});b.off("bookacti_unpick_all_events").on("bookacti_unpick_all_events",function(){bookacti_unpick_all_events_on_calendar($j(this))});b.trigger("bookacti_after_calendar_set_up")}function bookacti_fill_calendar_with_events(b){var a=b.attr("id");var d=b.find(".bookacti-calendar:first");d.fullCalendar("removeEvents");d.fullCalendar("addEventSource",bookacti.booking_system[a]["events"]["single"]);var c=bookacti_create_repeated_events(a,bookacti.booking_system[a]["events"]["repeated"]);$j.each(c,function(e,f){d.fullCalendar("addEventSource",f)})}function bookacti_pick_event_on_calendar(a,c){var d=c.start instanceof moment?c.start.format("YYYY-MM-DD HH:mm:ss"):c.start;var b=a.find('.fc-event[data-event-id="'+c.id+'"][data-event-start="'+d+'"]');b.addClass("bookacti-picked-event")}function bookacti_unpick_event_on_calendar(a,c,b){var e=c.start instanceof moment?c.start.format("YYYY-MM-DD HH:mm:ss"):c.start;var d=a.find('.fc-event[data-event-id="'+c.id+'"]');if(!b&&c.start){d=a.find('.fc-event[data-event-id="'+c.id+'"][data-event-start="'+e+'"]')}d.removeClass("bookacti-picked-event")}function bookacti_unpick_all_events_on_calendar(a){a.find(".bookacti-picked-event").removeClass("bookacti-picked-event")}function bookacti_refresh_picked_events_on_calendar(b){var a=b.attr("id");bookacti_unpick_all_events_on_calendar(b);$j.each(bookacti.booking_system[a]["picked_events"],function(d,e){var c=b.find('.fc-event[data-event-id="'+e.id+'"][data-event-start="'+e.start+'"]');c.addClass("bookacti-picked-event")});b.trigger("bookacti_refresh_picked_events_on_calendar")}function bookacti_set_calendar_period(a,h){h=typeof h==="undefined"?1:parseInt(h);var e=a.find(".bookacti-calendar");var k=a.attr("id");var g=false;var b=false;var j=false;var f=e.fullCalendar("option","validRange");if(typeof f==="object"&&f.start instanceof moment&&f.end instanceof moment){var m=f.start;var i=f.end.subtract(1,"days");j=true}bookacti.booking_system[k]["events"]=bookacti_sort_events_array_by_dates(bookacti.booking_system[k]["events"]);var c=false;if(bookacti.booking_system[k]["events"].length>0){var d=moment(bookacti.booking_system[k]["events"][0]["start"]);var l=moment(bookacti.booking_system[k]["events"][bookacti.booking_system[k]["events"].length-1]["end"]);c=true}if(j&&c){if(k==="bookacti-booking-system-bookings-page"){g=d;b=l}else{if(m.isBefore(d,"day")){g=d}else{g=m}if(i.isBefore(l,"day")){b=i}else{b=l}}}else{if(!j&&c){g=d;b=l}else{if(j&&!c){g=m;b=i}}}if(g&&!bookacti.booking_system[k]["past_events"]&&g.isBefore(moment(),"day")){g=moment()}if(g){g=g.format("YYYY-MM-DD")}if(b){b=b.format("YYYY-MM-DD")}if(bookacti.booking_system[k]["period"]===undefined){bookacti.booking_system[k]["period"]=[]}bookacti.booking_system[k]["period"]["start"]=g;bookacti.booking_system[k]["period"]["end"]=b;if(h){bookacti_refresh_calendar_view(a)}}function bookacti_refresh_calendar_view(e){var d=e.attr("id");var f=e.find(".bookacti-calendar");if(bookacti.booking_system[d]["period"]!==undefined){var a=bookacti.booking_system[d]["period"]["start"];var c=bookacti.booking_system[d]["period"]["end"];var g,b="";if(a&&c){g=moment(a);b=moment(c)}if(g!==""&&b!==""&&g<=b&&a&&c){f.show();e.siblings(".bookacti-notices ul:not(.bookacti-persistent-notice)").remove();bookacti_refresh_view(f,g,b);e.trigger("bookacti_view_refreshed")}else{bookacti_add_error_message(e,bookacti_localized.error_no_events_bookable)}}}function bookacti_refresh_view(c,a,b){c.fullCalendar("option","validRange",{start:a,end:b.add(1,"days")})}function bookacti_add_class_according_to_event_size(a){var b=bookacti.event_sizes;$j(a).trigger("bookacti_event_sizes",[a,b]);if($j(a).innerHeight()<b.tiny_height){a.addClass("bookacti-tiny-event")}if($j(a).innerHeight()<b.small_height){a.addClass("bookacti-small-event")}if($j(a).innerWidth()<b.narrow_width){a.addClass("bookacti-narrow-event")}if($j(a).innerWidth()>b.wide_width){a.addClass("bookacti-wide-event");a.removeClass("fc-short")}}function bookacti_update_calendar_settings(c,b){var a={};if(b.start&&b.end){a.validRange={start:moment(b.start),end:moment(b.end).add(1,"days")}}if(b.minTime){a.minTime=b.minTime}if(b.maxTime){a.maxTime=b.maxTime==="00:00"?"24:00":b.maxTime}if(b.snapDuration){a.snapDuration=b.snapDuration}c.trigger("bookacti_before_update_calendar_settings",[a,b]);if(!$j.isEmptyObject(a)){c.fullCalendar("option",a)}c.fullCalendar("option","validRange",a.validRange);c.trigger("bookacti_calendar_settings_updated",[a,b])}function bookacti_enter_calendar_loading_state(a){a.find(".fc-toolbar button").addClass("fc-state-disabled").attr("disabled",true);bookacti_append_loading_overlay(a.find(".fc-view-container"))}function bookacti_exit_calendar_loading_state(a){a.find(".fc-toolbar button").removeClass("fc-state-disabled").attr("disabled",false);bookacti_remove_loading_overlay(a.find(".fc-view-container"))}function bookacti_append_loading_overlay(a){a.append('<div class="bookacti-loading-overlay" ><div class="bookacti-loading-content" ><div class="bookacti-loading-box" ><div class="bookacti-loading-image" ><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /></div><div class="bookacti-loading-text" >'+bookacti_localized.loading+"</div></div></div></div>").css("position","relative")}function bookacti_remove_loading_overlay(a){a.find(".bookacti-loading-overlay").remove().css("position","static")};