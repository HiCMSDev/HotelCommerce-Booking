function bookacti_init_booking_system_dialogs(){$j(".bookacti-booking-system-dialog").dialog({modal:true,autoOpen:false,minHeight:300,minWidth:400,resize:"auto",show:true,hide:true,dialogClass:"bookacti-dialog",closeText:"&#10006;",close:function(){}});$j(".ui-widget-overlay").live("click",function(){$j("div:ui-dialog:visible").dialog("close")});$j("#bookacti-choose-group-of-events-dialog").dialog({title:bookacti_localized.dialog_choose_group_of_events_title});$j("#bookacti-groups-of-events-list").on("bookacti_group_of_events_preview",'input[name="group_of_events"]',function(f,d){var c=$j(this).val();var b=$j("#bookacti-groups-of-events-list").data("booking-system-id");var a=$j("#"+b);$j('.bookacti-group-of-events-option[data-group-id!="'+c+'"]').data("show-events",0).attr("data-show-events",0);$j('.bookacti-group-of-events-list[data-group-id!="'+c+'"]').hide(200);$j('.bookacti-group-of-events-option[data-group-id="'+c+'"]').data("show-events",1).attr("data-show-events",1);$j('.bookacti-group-of-events-list[data-group-id="'+c+'"]').show(200);bookacti_unpick_all_events(a);bookacti_pick_events_of_group(a,c,d)})}function bookacti_dialog_choose_group_of_events(i,d,x){var n=i.attr("id");var f=n==="bookacti-booking-system-bookings-page"?"booking_page":"frontend";$j("#bookacti-groups-of-events-list").data("booking-system-id",n);$j("#bookacti-groups-of-events-list").empty();if(bookacti.booking_system[n]["groups_single_events"]){var w="single";var z="";if(f==="booking_page"){var a=bookacti_get_bookings_number_for_a_single_grouped_event(i,x,d);var t=a>1?bookacti_localized.bookings:bookacti_localized.booking;z=a+" "+t}else{var p=bookacti_get_event_availability(i,x);var s=p>1?bookacti_localized.avails:bookacti_localized.avail;z=p+" "+s}var q=true;if(typeof bookacti.booking_system[n]["events_data"][x.id]!=="undefined"){q=false;var B=false;var m=parseInt(bookacti.booking_system[n]["events_data"][x.id]["activity_id"]);var v=bookacti.booking_system[n]["activities_data"][m]["settings"];var A=typeof v.min_bookings_per_user==="undefined"?0:(v.min_bookings_per_user?parseInt(v.min_bookings_per_user):0);if(A<=p){B=true}var u=max_users_ok=true;if(typeof bookacti.booking_system[n]["bookings"][x.id]!=="undefined"){var b=x.start instanceof moment?x.start.format("YYYY-MM-DD HH:mm:ss"):x.start;var k=x.end instanceof moment?x.end.format("YYYY-MM-DD HH:mm:ss"):x.end;var c=typeof v.max_bookings_per_user==="undefined"?0:(v.max_bookings_per_user?parseInt(v.max_bookings_per_user):0);var h=typeof v.max_users_per_event==="undefined"?0:(v.max_users_per_event?parseInt(v.max_users_per_event):0);if(c||h){$j.each(bookacti.booking_system[n]["bookings"][x.id],function(E,C){if(b===C.event_start&&k===C.event_end){var D=parseInt(C.current_user_bookings);if(h&&D===0&&C.distinct_users>=h){max_users_ok=false}if(c&&D>=c){u=false}return false}})}}if(B&&u&&max_users_ok){q=true}}var r=$j("<div />",{});var j=$j("<div />",{"class":"bookacti-group-of-events-option","data-group-id":w,"data-show-events":0});var o=$j("<input />",{id:"bookacti-group-of-events-"+w,type:"radio",name:"group_of_events",value:w,disabled:f!=="booking_page"&&!q,});var l=$j("<label />",{html:bookacti_localized.single_event+' <span class="bookacti-group-availability" >('+z+")</span>","for":"bookacti-group-of-events-"+w});var e=$j("<ul />",{"class":"bookacti-group-of-events-list bookacti-custom-scrollbar","data-group-id":w});var y=bookacti_format_event_duration(x.start,x.end);var g=$j("<li />",{html:'<span class="bookacti-booking-event-duration" >'+y+'</span><span class="bookacti-booking-event-title-separator" > - </span><span class="bookacti-booking-event-title" >'+x.title+"</span>"});j.append(o);j.append(l);r.append(j);e.append(g);r.append(e);$j("#bookacti-groups-of-events-list").append(r)}$j.each(d,function(U,S){S=parseInt(S);if(typeof bookacti.booking_system[n]["groups_events"][S]!=="undefined"){var L=bookacti.booking_system[n]["groups_data"][S]["availability"];var M=true;if(typeof bookacti.booking_system[n]["groups_data"][S]!=="undefined"){M=false;var Y=false;var K=bookacti.booking_system[n]["groups_data"][S];var D=parseInt(K.category_id);var V=bookacti.booking_system[n]["group_categories_data"][D]["settings"];var X=typeof V.min_bookings_per_user==="undefined"?0:(V.min_bookings_per_user?parseInt(V.min_bookings_per_user):0);if(X<=L&&L>0){Y=true}var H=typeof V.max_users_per_event==="undefined"?0:(V.max_users_per_event?parseInt(V.max_users_per_event):0);var F=typeof V.max_bookings_per_user==="undefined"?0:(V.max_bookings_per_user?parseInt(V.max_bookings_per_user):0);var R=max_users_ok=true;if(F||H){var T=parseInt(K.current_user_bookings);if(H&&T===0&&K.distinct_users>=H){max_users_ok=false}if(F&&T>=F){R=false}}if(Y&&R&&max_users_ok){M=true}}var O=$j("<div />",{});var I=$j("<div />",{"class":"bookacti-group-of-events-option","data-group-id":S,"data-show-events":0});var N=$j("<input />",{id:"bookacti-group-of-events-"+S,type:"radio",name:"group_of_events",disabled:f!=="booking_page"&&!M,value:S});var W="";if(f==="booking_page"){var E=0;$j.each(bookacti.booking_system[n]["groups_events"][S],function(aa,Z){if(x.id==Z.id&&x.start.format("YYYY-MM-DD HH:mm:ss")===Z.start&&x.end.format("YYYY-MM-DD HH:mm:ss")===Z.end){E=Z.group_bookings}});var Q=E>1?bookacti_localized.bookings:bookacti_localized.booking;W=E+" "+Q}else{var P=L>1?bookacti_localized.avails:bookacti_localized.avail;W=L+" "+P}var C={html:bookacti.booking_system[n]["groups_data"][S]["title"]+' <span class="bookacti-group-availability" >('+W+")</span>","for":"bookacti-group-of-events-"+S};i.trigger("bookacti_choose_group_dialog_group_label",[C,S,x]);var J=$j("<label />",C);var G=$j("<ul />",{"class":"bookacti-group-of-events-list bookacti-custom-scrollbar","data-group-id":S});$j.each(bookacti.booking_system[n]["groups_events"][S],function(ac,af){var aa=af.start.substr(0,10)===af.end.substr(0,10);var ae=moment(af.start).locale(bookacti_localized.current_lang_code);var ab=moment(af.end).locale(bookacti_localized.current_lang_code);var Z=ae.formatPHP(bookacti_localized.date_format)+bookacti_localized.dates_separator+ab.formatPHP(bookacti_localized.date_format);if(aa){Z=ae.formatPHP(bookacti_localized.date_format)+bookacti_localized.date_time_separator+ab.formatPHP(bookacti_localized.time_format)}var ad=$j("<li />",{html:'<span class="bookacti-booking-event-duration" >'+Z+'</span><span class="bookacti-booking-event-title-separator" > - </span><span class="bookacti-booking-event-title" >'+af.title+"</span>"});G.append(ad)});I.append(N);I.append(J);O.append(I);O.append(G);$j("#bookacti-groups-of-events-list").append(O)}});$j('#bookacti-groups-of-events-list input[name="group_of_events"]').on("change",function(){$j(this).trigger("bookacti_group_of_events_preview",[x])});$j('#bookacti-groups-of-events-list input[name="group_of_events"]:not([disabled]):first').prop("checked",true).trigger("change");$j("#bookacti-choose-group-of-events-dialog").dialog("open");$j("#bookacti-choose-group-of-events-dialog").dialog({close:function(){var C=$j('#bookacti-groups-of-events-list input[type="radio"]:checked').val();if(typeof C==="undefined"){bookacti_unpick_all_events(i)}}});$j("#bookacti-choose-group-of-events-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){var C=$j('#bookacti-groups-of-events-list input[type="radio"]:checked').val();if(typeof C!=="undefined"){bookacti_unpick_all_events(i);bookacti_pick_events_of_group(i,C,x);i.trigger("bookacti_group_of_events_chosen",[C,x])}$j(this).dialog("close")}}])};