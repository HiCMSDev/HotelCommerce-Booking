function bookacti_init_booking_system_dialogs(){$j(".bookacti-booking-system-dialog").dialog({modal:true,autoOpen:false,minHeight:300,minWidth:400,resize:"auto",show:true,hide:true,dialogClass:"bookacti-dialog",closeText:"&#10006;",close:function(){}});$j(".ui-widget-overlay").live("click",function(){$j("div:ui-dialog:visible").dialog("close")});$j("#bookacti-choose-group-of-events-dialog").dialog({title:bookacti_localized.dialog_choose_group_of_events_title});$j("#bookacti-groups-of-events-list").on("bookacti_group_of_events_preview",'input[name="group_of_events"]',function(f,d){var c=$j(this).val();var b=$j("#bookacti-groups-of-events-list").data("booking-system-id");var a=$j("#"+b);$j('.bookacti-group-of-events-option[data-group-id!="'+c+'"]').data("show-events",0).attr("data-show-events",0);$j('.bookacti-group-of-events-list[data-group-id!="'+c+'"]').hide(200);$j('.bookacti-group-of-events-option[data-group-id="'+c+'"]').data("show-events",1).attr("data-show-events",1);$j('.bookacti-group-of-events-list[data-group-id="'+c+'"]').show(200);bookacti_unpick_all_events(a);bookacti_pick_events_of_group(a,c,d)})}function bookacti_dialog_choose_group_of_events(k,e,z){var p=k.attr("id");var g=p==="bookacti-booking-system-bookings-page"?"booking_page":"frontend";$j("#bookacti-groups-of-events-list").data("booking-system-id",p);$j("#bookacti-groups-of-events-list").empty();if(bookacti.booking_system[p]["groups_single_events"]){var y="single";var B="";if(g==="booking_page"){var b=bookacti_get_bookings_number_for_a_single_grouped_event(k,z,e);var v=b>1?bookacti_localized.bookings:bookacti_localized.booking;B=b+" "+v}else{var r=bookacti_get_event_availability(k,z);var u=r>1?bookacti_localized.avails:bookacti_localized.avail;B=r+" "+u}var s=true;if(typeof bookacti.booking_system[p]["events_data"][z.id]!=="undefined"){s=false;var D=false;var o=parseInt(bookacti.booking_system[p]["events_data"][z.id]["activity_id"]);var x=bookacti.booking_system[p]["activities_data"][o]["settings"];var C=typeof x.min_bookings_per_user==="undefined"?0:(x.min_bookings_per_user?parseInt(x.min_bookings_per_user):0);if(C<=r){D=true}var w=max_users_ok=true;if(typeof bookacti.booking_system[p]["bookings"][z.id]!=="undefined"){var c=z.start instanceof moment?z.start.format("YYYY-MM-DD HH:mm:ss"):z.start;var m=z.end instanceof moment?z.end.format("YYYY-MM-DD HH:mm:ss"):z.end;var d=typeof x.max_bookings_per_user==="undefined"?0:(x.max_bookings_per_user?parseInt(x.max_bookings_per_user):0);var j=typeof x.max_users_per_event==="undefined"?0:(x.max_users_per_event?parseInt(x.max_users_per_event):0);if(d||j){$j.each(bookacti.booking_system[p]["bookings"][z.id],function(G,E){if(c===E.event_start&&m===E.event_end){var F=parseInt(E.current_user_bookings);if(j&&F===0&&E.distinct_users>=j){max_users_ok=false}if(d&&F>=d){w=false}return false}})}}if(D&&w&&max_users_ok){s=true}}var t=$j("<div />",{});var l=$j("<div />",{"class":"bookacti-group-of-events-option","data-group-id":y,"data-show-events":0});var q=$j("<input />",{id:"bookacti-group-of-events-"+y,type:"radio",name:"group_of_events",value:y,disabled:g!=="booking_page"&&!s,});var n=$j("<label />",{html:bookacti_localized.single_event+' <span class="bookacti-group-availability" >('+B+")</span>","for":"bookacti-group-of-events-"+y});var f=$j("<ul />",{"class":"bookacti-group-of-events-list bookacti-custom-scrollbar","data-group-id":y});var A=bookacti_format_event_duration(z.start,z.end);var i={title:z.title,duration:A,quantity:1};k.trigger("bookacti_group_of_events_list_data",[i,z]);var a={html:'<span class="bookacti-booking-event-duration" >'+i.duration+'</span><span class="bookacti-booking-event-title-separator" > - </span><span class="bookacti-booking-event-title" >'+i.title+"</span>"};k.trigger("bookacti_group_of_events_list_element_data",[a,z]);var h=$j("<li />",a);l.append(q);l.append(n);t.append(l);f.append(h);t.append(f);$j("#bookacti-groups-of-events-list").append(t)}$j.each(e,function(W,U){U=parseInt(U);if(typeof bookacti.booking_system[p]["groups_events"][U]!=="undefined"){var N=bookacti.booking_system[p]["groups_data"][U]["availability"];var O=true;if(typeof bookacti.booking_system[p]["groups_data"][U]!=="undefined"){O=false;var aa=false;var M=bookacti.booking_system[p]["groups_data"][U];var F=parseInt(M.category_id);var X=bookacti.booking_system[p]["group_categories_data"][F]["settings"];var Z=typeof X.min_bookings_per_user==="undefined"?0:(X.min_bookings_per_user?parseInt(X.min_bookings_per_user):0);if(Z<=N&&N>0){aa=true}var J=typeof X.max_users_per_event==="undefined"?0:(X.max_users_per_event?parseInt(X.max_users_per_event):0);var H=typeof X.max_bookings_per_user==="undefined"?0:(X.max_bookings_per_user?parseInt(X.max_bookings_per_user):0);var T=max_users_ok=true;if(H||J){var V=parseInt(M.current_user_bookings);if(J&&V===0&&M.distinct_users>=J){max_users_ok=false}if(H&&V>=H){T=false}}if(aa&&T&&max_users_ok){O=true}}var Q=$j("<div />",{});var K=$j("<div />",{"class":"bookacti-group-of-events-option","data-group-id":U,"data-show-events":0});var P=$j("<input />",{id:"bookacti-group-of-events-"+U,type:"radio",name:"group_of_events",disabled:g!=="booking_page"&&!O,value:U});var Y="";if(g==="booking_page"){var G=0;$j.each(bookacti.booking_system[p]["groups_events"][U],function(ac,ab){if(z.id==ab.id&&z.start.format("YYYY-MM-DD HH:mm:ss")===ab.start&&z.end.format("YYYY-MM-DD HH:mm:ss")===ab.end){G=ab.group_bookings}});var S=G>1?bookacti_localized.bookings:bookacti_localized.booking;Y=G+" "+S}else{var R=N>1?bookacti_localized.avails:bookacti_localized.avail;Y=N+" "+R}var E={html:bookacti.booking_system[p]["groups_data"][U]["title"]+' <span class="bookacti-group-availability" >('+Y+")</span>","for":"bookacti-group-of-events-"+U};k.trigger("bookacti_choose_group_dialog_group_label",[E,U,z]);var L=$j("<label />",E);var I=$j("<ul />",{"class":"bookacti-group-of-events-list bookacti-custom-scrollbar","data-group-id":U});$j.each(bookacti.booking_system[p]["groups_events"][U],function(ae,ah){var ac=ah.start.substr(0,10)===ah.end.substr(0,10);var ag=moment(ah.start).locale(bookacti_localized.current_lang_code);var ad=moment(ah.end).locale(bookacti_localized.current_lang_code);var ab=ag.formatPHP(bookacti_localized.date_format)+bookacti_localized.dates_separator+ad.formatPHP(bookacti_localized.date_format);if(ac){ab=ag.formatPHP(bookacti_localized.date_format)+bookacti_localized.date_time_separator+ad.formatPHP(bookacti_localized.time_format)}var af=$j("<li />",{html:'<span class="bookacti-booking-event-duration" >'+ab+'</span><span class="bookacti-booking-event-title-separator" > - </span><span class="bookacti-booking-event-title" >'+ah.title+"</span>"});I.append(af)});K.append(P);K.append(L);Q.append(K);Q.append(I);$j("#bookacti-groups-of-events-list").append(Q)}});$j('#bookacti-groups-of-events-list input[name="group_of_events"]').on("change",function(){$j(this).trigger("bookacti_group_of_events_preview",[z])});$j('#bookacti-groups-of-events-list input[name="group_of_events"]:not([disabled]):first').prop("checked",true).trigger("change");$j("#bookacti-choose-group-of-events-dialog").dialog("open");$j("#bookacti-choose-group-of-events-dialog").dialog({close:function(){var E=$j('#bookacti-groups-of-events-list input[type="radio"]:checked').val();if(typeof E==="undefined"){bookacti_unpick_all_events(k)}}});$j("#bookacti-choose-group-of-events-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){var E=$j('#bookacti-groups-of-events-list input[type="radio"]:checked').val();if(typeof E!=="undefined"){bookacti_unpick_all_events(k);bookacti_pick_events_of_group(k,E,z);k.trigger("bookacti_group_of_events_chosen",[E,z])}$j(this).dialog("close")}}])};