function bookacti_init_booking_system_dialogs(){$j(".bookacti-booking-system-dialog").dialog({modal:true,autoOpen:false,minHeight:300,minWidth:400,resize:"auto",show:true,hide:true,dialogClass:"bookacti-dialog",closeText:"&#10006;",close:function(){}});$j(".ui-widget-overlay").live("click",function(){$j("div:ui-dialog:visible").dialog("close")});$j("#bookacti-choose-group-of-events-dialog").dialog({title:bookacti_localized.dialog_choose_group_of_events_title});$j("#bookacti-groups-of-events-list").on("bookacti_group_of_events_preview",'input[name="group_of_events"]',function(f,d){var c=$j(this).val();var b=$j("#bookacti-groups-of-events-list").data("booking-system-id");var a=$j("#"+b);$j('.bookacti-group-of-events-option[data-group-id!="'+c+'"]').data("show-events",0).attr("data-show-events",0);$j('.bookacti-group-of-events-list[data-group-id!="'+c+'"]').hide(200);$j('.bookacti-group-of-events-option[data-group-id="'+c+'"]').data("show-events",1).attr("data-show-events",1);$j('.bookacti-group-of-events-list[data-group-id="'+c+'"]').show(200);bookacti_unpick_all_events(a);bookacti_pick_events_of_group(a,c,d)})}function bookacti_dialog_choose_group_of_events(i,d,x){var n=i.attr("id");var f=n==="bookacti-booking-system-bookings-page"?"booking_page":"frontend";$j("#bookacti-groups-of-events-list").data("booking-system-id",n);$j("#bookacti-groups-of-events-list").empty();if(bookacti.booking_system[n]["groups_single_events"]){var w="single";var z="";if(f==="booking_page"){var a=bookacti_get_bookings_number_for_a_single_grouped_event(i,x,d);var t=a>1?bookacti_localized.bookings:bookacti_localized.booking;z=a+" "+t}else{var p=bookacti_get_event_availability(i,x);var s=p>1?bookacti_localized.avails:bookacti_localized.avail;z=p+" "+s}var q=true;if(typeof bookacti.booking_system[n]["events_data"][x.id]!=="undefined"){q=false;var B=false;var m=parseInt(bookacti.booking_system[n]["events_data"][x.id]["activity_id"]);var v=bookacti.booking_system[n]["activities_data"][m]["settings"];var A=typeof v.min_bookings_per_user==="undefined"?0:(v.min_bookings_per_user?parseInt(v.min_bookings_per_user):0);if(A<=p){B=true}var u=max_users_ok=true;if(typeof bookacti.booking_system[n]["bookings"][x.id]!=="undefined"){var b=x.start instanceof moment?x.start.format("YYYY-MM-DD HH:mm:ss"):x.start;var k=x.end instanceof moment?x.end.format("YYYY-MM-DD HH:mm:ss"):x.end;var c=typeof v.max_bookings_per_user==="undefined"?0:(v.max_bookings_per_user?parseInt(v.max_bookings_per_user):0);var h=typeof v.max_users_per_event==="undefined"?0:(v.max_users_per_event?parseInt(v.max_users_per_event):0);if(c||h){$j.each(bookacti.booking_system[n]["bookings"][x.id],function(E,C){if(b===C.event_start&&k===C.event_end){var D=parseInt(C.current_user_bookings);if(h&&D===0&&C.distinct_users>=h){max_users_ok=false}if(c&&D>=c){u=false}return false}})}}if(B&&u&&max_users_ok){q=true}}var r=$j("<div />",{});var j=$j("<div />",{"class":"bookacti-group-of-events-option","data-group-id":w,"data-show-events":0});var o=$j("<input />",{id:"bookacti-group-of-events-"+w,type:"radio",name:"group_of_events",value:w,disabled:f!=="booking_page"&&!q,});var l=$j("<label />",{html:bookacti_localized.single_event+' <span class="bookacti-group-availability" >('+z+")</span>","for":"bookacti-group-of-events-"+w});var e=$j("<ul />",{"class":"bookacti-group-of-events-list","data-group-id":w});var y=bookacti_format_event_duration(x.start,x.end);var g=$j("<li />",{html:'<span class="bookacti-booking-event-title" >'+x.title+'</span><span class="bookacti-booking-event-title-separator" > - </span>'+y});j.append(o);j.append(l);r.append(j);e.append(g);r.append(e);$j("#bookacti-groups-of-events-list").append(r)}$j.each(d,function(T,R){R=parseInt(R);if(typeof bookacti.booking_system[n]["groups_events"][R]!=="undefined"){var L=bookacti.booking_system[n]["groups_data"][R]["availability"];var M=true;if(typeof bookacti.booking_system[n]["groups_data"][R]!=="undefined"){M=false;var X=false;var K=bookacti.booking_system[n]["groups_data"][R];var D=parseInt(K.category_id);var U=bookacti.booking_system[n]["group_categories_data"][D]["settings"];var W=typeof U.min_bookings_per_user==="undefined"?0:(U.min_bookings_per_user?parseInt(U.min_bookings_per_user):0);if(W<=L&&L>0){X=true}var H=typeof U.max_users_per_event==="undefined"?0:(U.max_users_per_event?parseInt(U.max_users_per_event):0);var F=typeof U.max_bookings_per_user==="undefined"?0:(U.max_bookings_per_user?parseInt(U.max_bookings_per_user):0);if(u||H){var S=parseInt(K.current_user_bookings);if(H&&S===0&&K.distinct_users>=H){max_users_ok=false}if(F&&S>=F){u=false}}if(X&&u&&max_users_ok){M=true}}var O=$j("<div />",{});var I=$j("<div />",{"class":"bookacti-group-of-events-option","data-group-id":R,"data-show-events":0});var N=$j("<input />",{id:"bookacti-group-of-events-"+R,type:"radio",name:"group_of_events",disabled:f!=="booking_page"&&!M,value:R});var V="";if(f==="booking_page"){var E=0;$j.each(bookacti.booking_system[n]["groups_events"][R],function(Z,Y){if(x.id==Y.id&&x.start.format("YYYY-MM-DD HH:mm:ss")===Y.start&&x.end.format("YYYY-MM-DD HH:mm:ss")===Y.end){E=Y.group_bookings}});var Q=E>1?bookacti_localized.bookings:bookacti_localized.booking;V=E+" "+Q}else{var P=L>1?bookacti_localized.avails:bookacti_localized.avail;V=L+" "+P}var C={html:bookacti.booking_system[n]["groups_data"][R]["title"]+' <span class="bookacti-group-availability" >('+V+")</span>","for":"bookacti-group-of-events-"+R};i.trigger("bookacti_choose_group_dialog_group_label",[C,R,x]);var J=$j("<label />",C);var G=$j("<ul />",{"class":"bookacti-group-of-events-list","data-group-id":R});$j.each(bookacti.booking_system[n]["groups_events"][R],function(ab,ae){var Z=ae.start.substr(0,10)===ae.end.substr(0,10);var ad=moment(ae.start).locale(bookacti_localized.current_lang_code);var aa=moment(ae.end).locale(bookacti_localized.current_lang_code);var Y=ad.formatPHP(bookacti_localized.date_format)+bookacti_localized.dates_separator+aa.formatPHP(bookacti_localized.date_format);if(Z){Y=ad.formatPHP(bookacti_localized.date_format)+bookacti_localized.date_time_separator+aa.formatPHP(bookacti_localized.time_format)}var ac=$j("<li />",{html:ae.title+" - "+Y});G.append(ac)});I.append(N);I.append(J);O.append(I);O.append(G);$j("#bookacti-groups-of-events-list").append(O)}});$j('#bookacti-groups-of-events-list input[name="group_of_events"]').on("change",function(){$j(this).trigger("bookacti_group_of_events_preview",[x])});$j('#bookacti-groups-of-events-list input[name="group_of_events"]:not([disabled]):first').prop("checked",true).trigger("change");$j("#bookacti-choose-group-of-events-dialog").dialog("open");$j("#bookacti-choose-group-of-events-dialog").dialog({close:function(){var C=$j('#bookacti-groups-of-events-list input[type="radio"]:checked').val();if(typeof C==="undefined"){bookacti_unpick_all_events(i)}}});$j("#bookacti-choose-group-of-events-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){var C=$j('#bookacti-groups-of-events-list input[type="radio"]:checked').val();bookacti_unpick_all_events(i);bookacti_pick_events_of_group(i,C,x);i.trigger("bookacti_group_of_events_chosen",[C,x]);$j(this).dialog("close")}}])};