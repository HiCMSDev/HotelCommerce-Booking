function bookacti_fetch_events(b,d){var a=b.attr("id");var c=bookacti.booking_system[a];d=d||c.events_interval;bookacti.booking_system[a]["events_interval"]=bookacti_get_extended_events_interval(b,d);bookacti_start_loading_booking_system(b);$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:{action:"bookactiFetchEvents",attributes:JSON.stringify(c),is_admin:bookacti_localized.is_admin,interval:d,nonce:bookacti_localized.nonce_fetch_events},dataType:"json",success:function(e){if(e.status==="success"){if($j.isEmptyObject(bookacti.booking_system[a]["events"])){bookacti.booking_system[a]["events"]=e.events}else{$j.extend(bookacti.booking_system[a]["events"],e.events)}if($j.isEmptyObject(bookacti.booking_system[a]["events_data"])){bookacti.booking_system[a]["events_data"]=e.events_data}else{$j.extend(bookacti.booking_system[a]["events_data"],e.events_data)}if(e.events.length){bookacti_booking_method_display_events(b,e.events)}}else{var f=bookacti_localized.error_display_event;if(e.error==="not_allowed"){f+="\n"+bookacti_localized.error_not_allowed}console.log(f);console.log(e)}},error:function(f){console.log("AJAX "+bookacti_localized.error_display_event);console.log(f)},complete:function(){bookacti_stop_loading_booking_system(b)}})}function bookacti_reload_booking_system(b){var a=b.attr("id");var c=bookacti.booking_system[a];bookacti_start_loading_booking_system(b);$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:{action:"bookactiReloadBookingSystem",attributes:JSON.stringify(c),is_admin:bookacti_localized.is_admin,nonce:bookacti_localized.nonce_reload_booking_system},dataType:"json",success:function(d){if(d.status==="success"){b.empty();bookacti_clear_booking_system_displayed_info(b);bookacti.booking_system[a]["events"]=d.events;bookacti.booking_system[a]["events_data"]=d.events_data;bookacti.booking_system[a]["events_interval"]=d.events_interval;bookacti.booking_system[a]["exceptions"]=d.exceptions;bookacti.booking_system[a]["bookings"]=d.bookings;bookacti.booking_system[a]["activities_data"]=d.activities_data;bookacti.booking_system[a]["groups_events"]=d.groups_events;bookacti.booking_system[a]["groups_data"]=d.groups_data;bookacti.booking_system[a]["group_categories_data"]=d.group_categories_data;bookacti.booking_system[a]["template_data"]=d.template_data;b.append(d.html_elements);bookacti_booking_method_set_up(b)}else{var e=bookacti_localized.error_reload_booking_system;if(d.error==="not_allowed"){e+="\n"+bookacti_localized.error_not_allowed}console.log(e);console.log(d)}},error:function(d){console.log("AJAX "+bookacti_localized.error_reload_booking_system);console.log(d)},complete:function(){bookacti_stop_loading_booking_system(b)}})}function bookacti_switch_booking_method(b,d){d=$j.inArray(d,bookacti_localized.available_booking_methods)===-1?"calendar":d;if(d===bookacti.booking_system[a]["method"]){return false}var a=b.attr("id");var c=bookacti.booking_system[a];bookacti_start_loading_booking_system(b);$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:{action:"bookactiSwitchBookingMethod",booking_system_id:a,attributes:JSON.stringify(c),method:d,nonce:bookacti_localized.nonce_switch_booking_method},dataType:"json",success:function(e){if(e.status==="success"){bookacti.booking_system[a]["method"]=d;b.empty();b.append(e.html_elements);bookacti_booking_method_set_up(b)}else{var f=bookacti_localized.error_switch_booking_method;if(e.error==="not_allowed"){f+="\n"+bookacti_localized.error_not_allowed}console.log(f);console.log(e)}},error:function(f){console.log("AJAX "+bookacti_localized.error_switch_booking_method);console.log(f)},complete:function(){bookacti_stop_loading_booking_system(b)}})}function bookacti_fetch_events_from_interval(e,d){var j=e.attr("id");var k=bookacti.booking_system[j]["events_interval"];var o=bookacti.booking_system[j]["template_data"];var p=moment.utc(o.start);var a=moment.utc(o.end);var h=d.start.isBefore(p)?p.clone():d.start.clone();var f=d.end.isAfter(a)?a.clone():d.end.clone();var l=false;var n=parseInt(bookacti_localized.event_load_interval);var r={start:h.clone(),end:f.clone()};if($j.isEmptyObject(k)){l=bookacti_get_new_interval_of_events(e,r,n)}else{var c=moment.utc(k.start);var q=moment.utc(k.end);if(h.isBefore(c)||f.isAfter(q)){var g=c.clone();var i=q.clone();var b=d.start.clone().subtract(1,"days");var m=d.end.clone().add(1,"days");if(((h.isBefore(c)&&f.isAfter(q))||(f.isBefore(c))||(h.isAfter(q)))&&!b.isSame(q)&&!m.isSame(c)){bookacti_booking_method_clear_events(e);l=bookacti_get_new_interval_of_events(e,r,n)}else{if(h.isBefore(c)||m.isSame(c)){g.subtract(n,"days");if(h.isBefore(g)){g=h.clone()}if(g.isBefore(p)){g=p.clone()}i=c.clone().subtract(1,"days")}else{if(f.isAfter(q)||b.isSame(q)){i.add(n,"days");if(f.isAfter(i)){i=f.clone()}if(i.isAfter(a)){i=a.clone()}g=q.clone().add(1,"days")}}l={start:g.format("YYYY-MM-DD"),end:i.format("YYYY-MM-DD")}}}}if(l!==false){if(j==="bookacti-template-calendar"){bookacti_fetch_events_on_template(null,l)}else{bookacti_fetch_events(e,l)}}}function bookacti_get_new_interval_of_events(b,h,l){var n=b.attr("id");var k=bookacti.booking_system[n]["template_data"];if(typeof k.start==="undefined"||typeof k.end==="undefined"){return{}}var p=bookacti.booking_system[n]["past_events"];var e=moment(bookacti_localized.current_time);var f=e.format("YYYY-MM-DD");var j=moment(k.start);var c=moment(k.end).add(1,"days");if(!p&&c.isBefore(e)){return[]}if($j.isEmptyObject(h)){if(j.isAfter(e)){h={start:k.start,end:k.start}}else{if(c.isBefore(e)){h={start:k.end,end:k.end}}else{h={start:f,end:f}}}}l=parseInt(l)||parseInt(bookacti_localized.event_load_interval);var o=moment(h.start);var a=moment(h.end).add(1,"days");var g=parseInt(Math.abs(moment(h.end).diff(h.start,"days")));if(g>l){l=g}var m=Math.round((l-g)/2);var i=m;if(p){o.subtract(m,"days");if(j.isAfter(o)){i+=Math.abs(o.diff(j,"days"));o=j.clone()}}else{i+=m}a.add(i,"days");if(c.isBefore(a)){a=c}var d={start:o.format("YYYY-MM-DD"),end:a.subtract(1,"days").format("YYYY-MM-DD")};return d}function bookacti_get_extended_events_interval(b,c){var a=b.attr("id");var e=bookacti.booking_system[a]["events_interval"];if($j.isEmptyObject(c)){return e}var d=[];if($j.isEmptyObject(e)){d={start:c.start,end:c.end}}else{d={start:moment(c.start).isBefore(e.start)?c.start:e.start,end:moment(c.end).isAfter(e.end)?c.end:e.end}}return d}function bookacti_refresh_booking_numbers(b,d){d=d||null;if(d&&!$j.isArray(d)){d=[d]}var a=b.attr("id");var c=bookacti.booking_system[a]["calendars"];if(a==="bookacti-template-calendar"){bookacti_start_template_loading()}else{bookacti_start_loading_booking_system(b)}$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:{action:"bookactiGetBookingNumbers",template_id:c,event_id:d,nonce:bookacti_localized.nonce_get_booking_numbers},dataType:"json",success:function(e){if(e.status==="success"){if(d!=null){$j.each(d,function(f,g){if(bookacti.booking_system[a]["bookings"][g]){delete bookacti.booking_system[a]["bookings"][g]}bookacti.booking_system[a]["bookings"][g]=e.bookings[g]})}else{bookacti.booking_system[a]["bookings"]=e.bookings}bookacti_booking_method_rerender_events(b)}else{if(e.error==="not_allowed"){alert(bookacti_localized.error_retrieve_booking_numbers+"\n"+bookacti_localized.error_not_allowed);console.log(e)}}},error:function(f){alert("AJAX "+bookacti_localized.error_retrieve_booking_numbers);console.log(f)},complete:function(){if(a==="bookacti-template-calendar"){bookacti_stop_template_loading()}else{bookacti_stop_loading_booking_system(b)}}})}function bookacti_event_click(b,d){var a=b.attr("id");var c=bookacti_get_event_group_ids(b,d);if(($j.isArray(c)&&c.length>1)||($j.isArray(c)&&c.length===1&&bookacti.booking_system[a]["groups_single_events"])){bookacti_dialog_choose_group_of_events(b,c,d)}else{bookacti_pick_events_of_group(b,c,d)}c=$j.isArray(c)&&c.length===1?c[0]:c;b.trigger("bookacti_event_click",[d,c])}function bookacti_get_event_group_ids(b,f){if(typeof f!=="object"){return false}else{if(typeof f.id==="undefined"||typeof f.start==="undefined"||typeof f.end==="undefined"){return false}}var a=b.attr("id");var g=f.id;var e=f.start instanceof moment?f.start.format("YYYY-MM-DD HH:mm:ss"):f.start;var c=f.end instanceof moment?f.end.format("YYYY-MM-DD HH:mm:ss"):f.end;var d=[];$j.each(bookacti.booking_system[a]["groups_events"],function(h,i){$j.each(i,function(j,k){if(k.id==g&&k.start===e&&k.end===c){d.push(h);return false}})});if(!d.length){d="single"}return d}function bookacti_fill_form_fields(b,d,c){c=$j.isArray(c)&&c.length===1?c[0]:c;c=$j.isNumeric(c)||c==="single"?c:false;var e=d.start instanceof moment?d.start.format("YYYY-MM-DD HH:mm:ss"):d.start;var a=d.end instanceof moment?d.end.format("YYYY-MM-DD HH:mm:ss"):d.end;if(c!==false){b.siblings(".bookacti-booking-system-inputs").find('input[name="bookacti_group_id"]').val(c)}b.siblings(".bookacti-booking-system-inputs").find('input[name="bookacti_event_id"]').val(d.id);b.siblings(".bookacti-booking-system-inputs").find('input[name="bookacti_event_start"]').val(e);b.siblings(".bookacti-booking-system-inputs").find('input[name="bookacti_event_end"]').val(a)}function bookacti_pick_events_of_group(b,d,c){d=$j.isArray(d)&&d.length===1?d[0]:d;d=$j.isNumeric(d)||d==="single"?d:false;if(d==="single"&&typeof c!=="object"){return false}if(!d&&typeof c!=="object"){return false}if(!d&&typeof c==="object"){d="single"}var a=b.attr("id");bookacti_unpick_all_events(b);if(d==="single"){bookacti_pick_event(b,c)}else{$j.each(bookacti.booking_system[a]["groups_events"][d],function(f,e){bookacti_pick_event(b,e)})}b.trigger("bookacti_events_picked",[d,c])}function bookacti_pick_event(b,c){var a=b.attr("id");if((typeof c!=="object")||(typeof c==="object"&&(typeof c.id==="undefined"||typeof c.start==="undefined"))){return false}var d={id:c.id,title:c.title,start:c.start instanceof moment?c.start.format("YYYY-MM-DD HH:mm:ss"):c.start,end:c.end instanceof moment?c.end.format("YYYY-MM-DD HH:mm:ss"):c.end,bookings:c.bookings};bookacti.booking_system[a]["picked_events"].push(d);b.trigger("bookacti_pick_event",[c])}function bookacti_unpick_event(b,e,g,d){var a=b.attr("id");d=d?true:false;g=typeof g!=="undefined"?g:false;if((typeof e!=="object"&&!$j.isNumeric(e))||(typeof e==="object"&&(typeof e.id==="undefined"||typeof e.start==="undefined"))||($j.isNumeric(e)&&!d&&typeof g==="undefined")){return false}if(!g&&typeof e==="object"){g=d?false:e.start}var c={id:typeof e==="object"?e.id:e,start:g instanceof moment?g.format("YYYY-MM-DD HH:mm:ss"):g};var f=$j.grep(bookacti.booking_system[a]["picked_events"],function(h){if(h.id==c.id&&(d||h.start.substr(0,10)===c.start.substr(0,10))){return false}return true});bookacti.booking_system[a]["picked_events"]=f;b.trigger("bookacti_unpick_event",[e,d])}function bookacti_unpick_all_events(b){var a=b.attr("id");bookacti.booking_system[a]["picked_events"]=[];b.trigger("bookacti_unpick_all_events")}function bookacti_fill_picked_events_list(c){var b=c.attr("id");var d=c.siblings(".bookacti-picked-events").find(".bookacti-picked-events-list-title");var a=c.siblings(".bookacti-picked-events").find(".bookacti-picked-events-list");a.empty();if(typeof bookacti.booking_system[b]["picked_events"]!=="undefined"){if(bookacti.booking_system[b]["picked_events"].length>0){if(bookacti.booking_system[b]["picked_events"].length>1){d.html(bookacti_localized.selected_events)}else{d.html(bookacti_localized.selected_event)}$j.each(bookacti.booking_system[b]["picked_events"],function(g,l){var f=bookacti_format_event_duration(l.start,l.end);var e={title:'<span class="bookacti-booking-event-title" >'+l.title+"</span>",duration:f,quantity:1};c.trigger("bookacti_picked_events_list_data",[e]);var h=bookacti.booking_system[b]["events_data"][l.id]["activity_id"];var k=bookacti_get_activity_unit(c,h,e.quantity);if(k!==""){k='<span class="bookacti-booking-event-quantity-separator" > - </span><span class="bookacti-booking-event-quantity" >'+k+"</span>"}var j=$j("<li />",{html:e.title+'<span class="bookacti-booking-event-title-separator" > - </span>'+f+k});a.append(j)});c.siblings(".bookacti-picked-events").show();c.trigger("bookacti_picked_events_list_filled")}}}function bookacti_format_event_duration(a,c){a=a instanceof moment?a.format("YYYY-MM-DD HH:mm:ss"):a;c=c instanceof moment?c.format("YYYY-MM-DD HH:mm:ss"):c;var b=moment(a).locale(bookacti_localized.current_lang_code);var f=moment(c).locale(bookacti_localized.current_lang_code);var i=a.substr(0,10)===c.substr(0,10);var g=i?"bookacti-booking-event-end-same-day":"";var h=i?f.formatPHP(bookacti_localized.time_format):f.formatPHP(bookacti_localized.date_format);var d=i?bookacti_localized.date_time_separator:bookacti_localized.dates_separator;var e='<span class="bookacti-booking-event-start">'+b.formatPHP(bookacti_localized.date_format)+'</span><span class="bookacti-booking-event-date-separator '+g+'">'+d+'</span><span class="bookacti-booking-event-end '+g+'">'+h+"</span>";return e}function bookacti_get_activity_unit(b,c,f){var a=b.attr("id");var e=bookacti.booking_system[a]["activities_data"][c];f=$j.isNumeric(f)?parseInt(f):1;var d="";if(!c||typeof e==="undefined"||f===0){return""}if(typeof e!=="undefined"){if(typeof e.settings!=="undefined"){if(typeof e.settings["unit_name_plural"]!=="undefined"&&typeof e.settings["unit_name_singular"]!=="undefined"&&typeof e.settings["places_number"]!=="undefined"){if(e.settings["unit_name_plural"]!==""&&e.settings["unit_name_singular"]!==""){d+=f+" ";if(f>1){d+=e.settings["unit_name_plural"]}else{d+=e.settings["unit_name_singular"]}}if(e.settings["places_number"]!==""&&parseInt(e.settings["places_number"])>0){if(parseInt(e.settings["places_number"])>1){d+=" "+bookacti_localized.n_persons_per_booking.replace("%1$s",e.settings["places_number"])}else{d+=" "+bookacti_localized.one_person_per_booking}}if((e.settings["unit_name_plural"]!==""&&e.settings["unit_name_singular"]!=="")||(e.settings["places_number"]!==""&&parseInt(e.settings["places_number"])!==0)){d+="<br/>"}}}}return d}function bookacti_clear_booking_system_displayed_info(a){a.siblings(".bookacti-booking-system-inputs").find("input").val("");a.siblings(".bookacti-picked-events").find(".bookacti-picked-events-list").empty();a.siblings(".bookacti-picked-events").hide();bookacti_unpick_all_events(a);a.siblings(".bookacti-notices").hide();a.siblings(".bookacti-notices").empty();a.show();a.trigger("bookacti_displayed_info_cleared")}function bookacti_get_event_number_of_bookings(d,g){var c=d.attr("id");var b=bookacti.booking_system[c]["bookings"];if(!b){return 0}var a=bookacti.booking_system[c]["bookings"][g.id];if(!a){return 0}var f=g.start instanceof moment?g.start.format("YYYY-MM-DD HH:mm:ss"):g.start;var e=g.end instanceof moment?g.end.format("YYYY-MM-DD HH:mm:ss"):g.end;var h=0;$j.each(a,function(k,j){if(f===j.event_start&&e===j.event_end){h=parseInt(j.quantity);return false}});return h}function bookacti_get_event_availability(b,c){var a=b.attr("id");var d=bookacti.booking_system[a]["events_data"][c.id]["availability"];var e=bookacti_get_event_number_of_bookings(b,c);return parseInt(d)-parseInt(e)}function bookacti_get_group_availability(a,c){if(!$j.isArray(c)||c.length<=0){return 0}var b=999999999999;$j.each(c,function(d,e){var f=bookacti_get_event_availability(a,e);b=f<b?f:b});return b}function bookacti_is_event_available(b,d){var a=b.attr("id");var e=bookacti_get_event_availability(b,d);var f=false;if(e>0){f=true;if(!bookacti.booking_system[a]["groups_single_events"]){var c=bookacti_get_event_group_ids(b,d);if($j.isArray(c)&&c.length>0){f=false;$j.each(c,function(h,j){var g=bookacti_get_group_availability(b,bookacti.booking_system[a]["groups_events"][j]);if(g>0){f=true;return false}})}}}return f}function bookacti_get_bookings_number_for_a_single_grouped_event(a,b,g){var h=a.attr("id");g=g||bookacti_get_event_group_ids(a,b);var c=b.start instanceof moment?b.start.format("YYYY-MM-DD HH:mm:ss"):b.start;var d=b.end instanceof moment?b.end.format("YYYY-MM-DD HH:mm:ss"):b.end;var f=bookacti_get_event_number_of_bookings(a,b);var i=bookacti.booking_system[h]["groups_events"];var e=0;$j.each(g,function(j,k){$j.each(i[k],function(m,l){if(b.id===l.id&&c===l.start&&d===l.end){e+=parseInt(l.group_bookings)}})});return f-e}function bookacti_get_event_availability_div(a,c){var j=a.attr("id");var h=bookacti_get_event_availability(a,c);var d="";var k=bookacti.booking_system[j]["events_data"][c.id]["activity_id"];if(k){var g=bookacti.booking_system[j]["activities_data"][k];if(g!==undefined){if(g.settings!==undefined){if(g.settings["unit_name_plural"]!==undefined&&g.settings["unit_name_singular"]!==undefined&&g.settings["show_unit_in_availability"]!==undefined){if(parseInt(g.settings["show_unit_in_availability"])){if(h>1){d=g.settings["unit_name_plural"]}else{d=g.settings["unit_name_singular"]}}}}}}var f=h>1?bookacti_localized.avails:bookacti_localized.avail;var e=bookacti.booking_system[j]["events_data"][c.id]["availability"];var l=h<e?"bookacti-booked":"bookacti-not-booked";var i=h<=0?"bookacti-full":"";var b='<div class="bookacti-availability-container" ><span class="bookacti-available-places '+l+" "+i+'" ><span class="bookacti-available-places-number">'+h+'</span><span class="bookacti-available-places-unit-name"> '+d+'</span><span class="bookacti-available-places-avail-particle"> '+f+"</span></span></div>";return b}function bookacti_get_event_number_of_bookings_div(a,c){var h=a.attr("id");var d=parseInt(bookacti.booking_system[h]["events_data"][c.id]["availability"]);var e=bookacti_get_event_number_of_bookings(a,c);var f=bookacti_get_event_availability(a,c);var i=d===0?"bookacti-no-availability":"";var j=e>0?"bookacti-booked":"bookacti-not-booked";var g=f<=0?"bookacti-full":"";var b='<div class="bookacti-availability-container" ><span class="bookacti-available-places '+j+" "+g+" "+i+'" ><span class="bookacti-active-bookings-number">'+e+"</span></span></div>";return b}function bookacti_sort_events_array_by_dates(d,b,a,c){b=b||false;a=a||false;c=c||{start:"start",end:"end"};d.sort(function(f,e){var g=b?0:new Date(f[c.start])-new Date(e[c.start]);if(g===0){g=new Date(f[c.end])-new Date(e[c.end])}if(a===true){g=!g}return g});return d}function bookacti_booking_method_set_up(b,d,c){var a=b.attr("id");c=c||bookacti.booking_system[a]["method"];d=d?1:0;if(c==="calendar"||$j.inArray(c,bookacti_localized.available_booking_methods)===-1){bookacti_set_calendar_up(b,d)}else{b.trigger("bookacti_booking_method_set_up",[c,d])}}function bookacti_booking_method_display_events(b,c,d){var a=b.attr("id");d=d||bookacti.booking_system[a]["method"];if(d==="calendar"||$j.inArray(d,bookacti_localized.available_booking_methods)===-1){bookacti_display_events_on_calendar(b,c)}else{b.trigger("bookacti_booking_method_display_events",[d,c])}}function bookacti_booking_method_update_template_data(b,c,d){var a=b.attr("id");d=d||bookacti.booking_system[a]["method"];c=c||bookacti.booking_system[a]["template_data"];if(d==="calendar"||$j.inArray(d,bookacti_localized.available_booking_methods)===-1){bookacti_update_calendar_settings(b.find(".bookacti-calendar:first"),bookacti.booking_system[a]["template_data"])}else{b.trigger("bookacti_update_template_data",[d,c])}}function bookacti_booking_method_refetch_events(b,c){var a=b.attr("id");c=c||bookacti.booking_system[a]["method"];if(c==="calendar"||$j.inArray(c,bookacti_localized.available_booking_methods)===-1){b.find(".bookacti-calendar").fullCalendar("removeEvents");bookacti_fetch_events(b)}else{b.trigger("bookacti_refetch_events",[c])}}function bookacti_booking_method_rerender_events(b,c){var a=b.attr("id");c=c||bookacti.booking_system[a]["method"];if(c==="calendar"||$j.inArray(c,bookacti_localized.available_booking_methods)===-1){b.find(".bookacti-calendar").fullCalendar("rerenderEvents")}else{b.trigger("bookacti_rerender_events",[c])}}function bookacti_booking_method_clear_events(b,d,c){var a=b.attr("id");c=c||bookacti.booking_system[a]["method"];d=d||null;if(!d){bookacti.booking_system[a]["events"]=[];bookacti.booking_system[a]["events_data"]=[];bookacti.booking_system[a]["events_interval"]=[]}else{delete bookacti.booking_system[a]["events_data"][d.id]}if(c==="calendar"||$j.inArray(c,bookacti_localized.available_booking_methods)===-1){bookacti_clear_events_on_calendar(b,d)}else{b.trigger("bookacti_clear_events",[c,d])}}function bookacti_start_loading_booking_system(b){var a=b.attr("id");var c=bookacti.booking_system[a]["method"];var d='<div class="bookacti-loading-alt"><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /><span class="bookacti-loading-alt-text" >'+bookacti_localized.loading+"</span></div>";if(!$j.isNumeric(bookacti.booking_system[a]["loading_number"])){bookacti.booking_system[a]["loading_number"]=0}if(c==="calendar"||$j.inArray(c,bookacti_localized.available_booking_methods)===-1){if(b.find(".bookacti-calendar.fc").length){if(bookacti.booking_system[a]["loading_number"]===0||!b.find(".bookacti-loading-overlay").length){b.find(".bookacti-loading-alt").remove();bookacti_enter_calendar_loading_state(b.find(".bookacti-calendar"))}}else{if(!b.find(".bookacti-loading-alt").length){b.append(d)}}}else{b.trigger("bookacti_start_loading",[c,d])}if(bookacti.booking_system[a]["loading_number"]===0){b.trigger("bookacti_enter_loading_state")}bookacti.booking_system[a]["loading_number"]++}function bookacti_stop_loading_booking_system(b,c){c=c||false;var a=b.attr("id");var d=bookacti.booking_system[a]["method"];bookacti.booking_system[a]["loading_number"]--;bookacti.booking_system[a]["loading_number"]=Math.max(bookacti.booking_system[a]["loading_number"],0);if(c){bookacti.booking_system[a]["loading_number"]=0}if(bookacti.booking_system[a]["loading_number"]===0){if(d==="calendar"||$j.inArray(d,bookacti_localized.available_booking_methods)===-1){bookacti_exit_calendar_loading_state(b.find(".bookacti-calendar"))}else{b.trigger("bookacti_stop_loading",[d])}b.find(".bookacti-loading-alt").remove();b.trigger("bookacti_exit_loading_state")}};