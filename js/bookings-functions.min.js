
function bookacti_bind_bookings_dialogs(a){$j("#bookacti-bookings-filters-param-gear").on("click","img",function(){bookacti_dialog_bookings_filters_param(a)});$j("#bookacti-bookings-list-param-gear").on("click","img",function(){bookacti_dialog_booking_list_param(a)})}function bookacti_init_booking_actions(){$j(".bookacti-booking-actions, .bookacti-booking-group-actions, #bookacti-bookings-list").on("click",".bookacti-booking-action, .bookacti-booking-group-action",function(c){c.preventDefault();if($j(this).hasClass("bookacti-booking-action")){var b=$j(this).data("booking-id");if($j(this).hasClass("bookacti-cancel-booking")){bookacti_dialog_cancel_booking(b,"single")}else{if($j(this).hasClass("bookacti-reschedule-booking")){bookacti_dialog_reschedule_booking(b)}else{if($j(this).hasClass("bookacti-refund-booking")){bookacti_dialog_refund_booking(b,"single")}else{if($j(this).hasClass("bookacti-change-booking-state")){bookacti_dialog_change_booking_state(b,"single")}}}}}else{var a=$j(this).data("booking-group-id");if($j(this).hasClass("bookacti-cancel-booking-group")){bookacti_dialog_cancel_booking(a,"group")}else{if($j(this).hasClass("bookacti-refund-booking-group")){bookacti_dialog_refund_booking(a,"group")}else{if($j(this).hasClass("bookacti-change-booking-group-state")){bookacti_dialog_change_booking_state(a,"group")}else{if($j(this).hasClass("bookacti-show-booking-group-bookings")){bookacti_fill_booking_list($j("#bookacti-booking-system-bookings-page"),null,null,a)}}}}}if($j(this).attr("href")&&$j(this).attr("href")!==""&&!$j(this).hasClass("prevent-default")){if($j(this).hasClass("_blank")){window.open($j(this).attr("href"))}else{location.href=$j(this).attr("href")}}})}function bookacti_init_booking_filters(a){$j(".bookacti-bookings-filter-activity, .bookacti-bookings-filter-template").off("click").on("click",function(b){bookacti_select_bookings_filter(b,a,$j(this));if($j(this).hasClass("bookacti-bookings-filter-template")){bookacti_filter_bookings_by_templates(a)}else{if($j(this).hasClass("bookacti-bookings-filter-activity")){bookacti_filter_bookings_by_activities(a)}}});bookacti_filter_bookings_by_activities(a)}function bookacti_select_bookings_filter(c,a,b){c=c||false;if(c&&!bookacti.is_touch_device){if(!c.ctrlKey){b.parent().find(".bookacti-bookings-filter").attr("selected",false)}}if(b.is("[selected]")){b.attr("selected",false)}else{b.attr("selected",true)}}function bookacti_filter_bookings_by_templates(b){var a=b.attr("id");var d=b.find(".bookacti-calendar");var f=[];$j(".bookacti-bookings-filter-template[selected]").each(function(){f.push($j(this).data("template-id").toString())});var c=bookacti_compare_arrays(bookacti.booking_system[a]["calendars"],f);if(!c){bookacti_clear_booking_system_displayed_info(b);var e=[];$j(".bookacti-bookings-filter-activity[selected]").each(function(){var g=$j(this).data("activity-id");e.push(g)});bookacti_start_loading_booking_system(b);$j.ajax({url:ajaxurl,data:{action:"bookactiSelectTemplateFilter",template_ids:f,nonce:bookacti_localized.nonce_selected_template_filter},type:"POST",dataType:"json",success:function(h){if(h.status==="success"){bookacti_update_calendar_settings(d,h.template_data);d.fullCalendar("gotoDate",moment());bookacti_booking_method_clear_events(b);bookacti.booking_system[a]["events"]=h.events;bookacti.booking_system[a]["calendars"]=h.calendar_ids;bookacti.booking_system[a]["activities"]=h.activity_ids;bookacti.booking_system[a]["group_categories"]=h.group_categories;bookacti.booking_system[a]["template_data"]=h.template_data;bookacti.booking_system[a]["events_data"]=h.events_data;bookacti.booking_system[a]["events_interval"]=h.events_interval;bookacti.booking_system[a]["activities_data"]=h.activities_data;bookacti.booking_system[a]["groups_events"]=h.groups_events;bookacti.booking_system[a]["groups_data"]=h.groups_data;bookacti.booking_system[a]["group_categories_data"]=h.group_categories_data;bookacti.booking_system[a]["bookings"]=h.bookings;bookacti_display_events_on_calendar(b,h.events);$j("#bookacti-activities-filter-content").html(h.activities_html);bookacti_filter_bookings_by_activities(b)}else{if(h.status==="failed"){var g=bookacti_localized.error_switch_template;if(h.error==="not_allowed"){g+="\n"+bookacti_localized.error_not_allowed}console.log(g);console.log(h)}}},error:function(g){console.log("AJAX "+bookacti_localized.error_switch_template);console.log(g)},complete:function(){bookacti_stop_loading_booking_system(b)}})}}function bookacti_filter_bookings_by_activities(a){bookacti.hidden_activities=[];$j(".bookacti-bookings-filter-activity").each(function(){var b=$j(this).data("activity-id");bookacti.hidden_activities.push(b)});if(!$j(".bookacti-bookings-filter-activity[selected]").length){$j(".bookacti-bookings-filter-activity:first").attr("selected",true)}$j(".bookacti-bookings-filter-activity[selected]").each(function(){var c=$j(this).data("activity-id");var b=$j.inArray(c,bookacti.hidden_activities);bookacti.hidden_activities.splice(b,1)});a.find(".bookacti-calendar").fullCalendar("rerenderEvents")}function bookacti_fill_booking_list(c,d,b,a){d=d||false;b=b||false;a=a||false;var e={action:"bookactiGetBookingRows",nonce:bookacti_localized.nonce_get_booking_rows};if(typeof a!=="undefined"&&$j.isNumeric(a)){e.booking_group_id=a}else{if(typeof b!=="undefined"&&$j.isNumeric(b)){e.event_group_id=b}else{e.event_id=d.id;e.event_start=d.start instanceof moment?d.start.format("YYYY-MM-DD HH:mm:ss"):d.start;e.event_end=d.end instanceof moment?d.end.format("YYYY-MM-DD HH:mm:ss"):d.end}}bookacti_start_loading_booking_system(c);$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:e,dataType:"json",success:function(g){if(g.status==="success"){$j("#bookacti-bookings-list-container #the-list").html(g.rows);$j("#bookacti-bookings-list").trigger("bookacti_booking_list_filled")}else{if(g.status==="failed"){var f=bookacti_localized.error_retrieve_bookings;if(g.error==="not_allowed"){f+="\n"+bookacti_localized.error_not_allowed}var h='<tr class="no-items" ><td class="colspanchange" colspan="'+$j("#bookacti-bookings-list table tr th").length+'" >'+f+"</td></tr>";$j("#bookacti-bookings-list-container #the-list").html(h)}}},error:function(f){console.log("AJAX "+bookacti_localized.error_retrieve_bookings);console.log(f)},complete:function(){bookacti_stop_loading_booking_system(c)}})}function bookacti_bookings_enter_loading_state(a){$j(".bookacti-bookings-title-gear").off("click");$j(".bookacti-bookings-filter").off("click");$j(".bookacti-bookings-title-gear").attr("disabled",true);$j(".bookacti-bookings-filter-content").attr("disabled",true);$j("#bookacti-bookings-list .bookacti-booking-action").attr("disabled",true)}function bookacti_bookings_exit_loading_state(a){bookacti_init_booking_filters(a);bookacti_bind_bookings_dialogs(a);$j(".bookacti-bookings-title-gear").attr("disabled",false);$j(".bookacti-bookings-filter-content").attr("disabled",false);$j("#bookacti-bookings-list .bookacti-booking-action").attr("disabled",false)}function bookacti_booking_row_enter_loading_state(b){var a='<div class="bookacti-loading-alt"><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /><span class="bookacti-loading-alt-text" >'+bookacti_localized.loading+"</span></div>";b.find(".bookacti-booking-state").hide();b.find(".bookacti-booking-state").after(a);b.find(".bookacti-booking-action").attr("disabled",true)}function bookacti_booking_row_exit_loading_state(a){a.find(".bookacti-loading-alt").remove();a.find(".bookacti-booking-state").show();a.find(".bookacti-booking-action").attr("disabled",false)}function bookacti_validate_picked_events(a,d){a=a||$j(".bookacti-booking-system:first");d=d||0;var j=a.attr("id");var i=a.parent().find('input[name="bookacti_group_id"]').val();var k=a.parent().find('input[name="bookacti_event_id"]').val();var b=a.parent().find('input[name="bookacti_event_start"]').val();var g=a.parent().find('input[name="bookacti_event_end"]').val();var c=0;var e={is_group:false,is_event:false,is_event_in_selected:false,are_picked_events_same_as_group:false,is_corrupted:false,is_qty_sup_to_avail:false,is_qty_sup_to_0:false,send:false};if(k!==""&&b!==""&&g!==""){e.is_event=true}if(i!==""&&(($j.isNumeric(i)&&typeof bookacti.booking_system[j]["groups_events"][i]!=="undefined")||(i==="single"&&e.is_event))){e.is_group=true}if(parseInt(d)>0){e.is_qty_sup_to_0=true}if(e.is_group&&typeof bookacti.booking_system[j]["picked_events"]!=="undefined"){if(i==="single"&&bookacti.booking_system[j]["picked_events"].length===1){if(bookacti.booking_system[j]["picked_events"][0]["id"]===k&&bookacti.booking_system[j]["picked_events"][0]["start"]===b&&bookacti.booking_system[j]["picked_events"][0]["end"]===g){e.is_event_in_selected=true;c=bookacti_get_event_availability(a,bookacti.booking_system[j]["picked_events"][0])}}else{if(bookacti.booking_system[j]["picked_events"].length===bookacti.booking_system[j]["groups_events"][i].length){var f=true;$j.each(bookacti.booking_system[j]["picked_events"],function(m,n){var l=false;$j.each(bookacti.booking_system[j]["groups_events"][i],function(p,o){if(n.id==o.id&&n.start===o.start&&n.end===o.end){l=true;return false}});if(!l){f=false;return false}});e.are_picked_events_same_as_group=f;c=bookacti_get_group_availability(a,bookacti.booking_system[j]["groups_events"][i])}}}if((parseInt(d)>parseInt(c))&&c!==0){e.is_qty_sup_to_avail=true}if((i==="single"&&e.is_event&&!e.is_event_in_selected)||($j.isNumeric(i)&&(!e.is_group||!e.are_picked_events_same_as_group))){e.is_corrupted=true}if(e.is_event&&e.is_group&&e.is_qty_sup_to_0&&!e.is_qty_sup_to_avail&&!e.is_corrupted){e.send=true}a.siblings(".bookacti-notices").empty();a.trigger("bookacti_validate_picked_events",[e]);if(!e.send){var h="";if((!e.is_event||!e.is_event_in_selected)&&!e.is_corrupted){h+="<li>"+bookacti_localized.error_select_schedule+"</li>"}if(e.is_qty_sup_to_avail){h+="<li>"+bookacti_localized.error_less_avail_than_quantity.replace("%1$s",d).replace("%2$s",c)+"</li>"}if(!e.is_qty_sup_to_0){h+="<li>"+bookacti_localized.error_quantity_inf_to_0+"</li>"}if(e.is_corrupted){h+="<li>"+bookacti_localized.error_corrupted_schedule+"</li>"}if(h!==""){a.siblings(".bookacti-notices").append("<ul class='bookacti-error-list'>"+h+"</ul>").show()}}return e.send};