$j(document).ready(function(){if(!$j("form#bookacti-form-editor-page-form").length||typeof bookacti.form_editor==="undefined"){return}bookacti_init_add_and_remove_items();$j("#bookacti-form-field-dialog-free_text").dialog("option","width",540);$j("#bookacti-form-field-dialog-terms").dialog("option","width",540);bookacti_init_form_editor_actions();$j("#bookacti-form-editor").on("click",".bookacti-form-editor-field-header",function(d){if($j(d.target).hasClass("bookacti-form-editor-field-action")){return}var c=$j(this).find(".bookacti-field-toggle");c.toggleClass("dashicons-arrow-up dashicons-arrow-down");c.closest(".bookacti-form-editor-field").find(".bookacti-form-editor-field-body").toggle();var b=c.closest(".bookacti-form-editor-field").find(".bookacti-form-editor-field-body").is(":visible");var a=c.closest(".bookacti-form-editor-field").find(".bookacti-booking-system");if(b&&a.length){bookacti_booking_method_rerender_events(a)}});$j("#bookacti-form-editor").sortable({items:".bookacti-form-editor-field:not(.ui-state-disabled):not(.bookacti-form-editor-promo-field)",handle:".bookacti-form-editor-field-title",placeholder:"bookacti-form-editor-field-placeholder",update:function(b,a){bookacti_save_form_field_order()}});$j("#bookacti-form-editor").disableSelection();$j("form#bookacti-form-editor-page-form").on("submit",function(a){if(!$j("form#bookacti-form-editor-page-form").length){return}a.preventDefault();bookacti_save_form()});$j("#bookacti-form-editor").on("bookacti_field_update_dialog",function(c,a,b){if(b==="calendar"){bookacti_fill_fields_from_array(bookacti.form_editor.fields[a].template_data.settings,"","form#bookacti-form-field-form-"+b);bookacti_fill_fields_from_array(bookacti.form_editor.fields[a].raw,"","form#bookacti-form-field-form-"+b);if(bookacti.form_editor.fields[a].calendars.length===0){if($j("#bookacti-multiple-select-_bookacti_template").length){$j("#bookacti-multiple-select-_bookacti_template").prop("checked",true);bookacti_switch_select_to_multiple("#bookacti-multiple-select-_bookacti_template")}$j("#_bookacti_template option").prop("selected",true);$j("#_bookacti_template").trigger("change")}if(bookacti.form_editor.fields[a].activities.length===0){if($j("#bookacti-multiple-select-activities").length){$j("#bookacti-multiple-select-activities").prop("checked",true);bookacti_switch_select_to_multiple("#bookacti-multiple-select-activities")}$j("#activities option").prop("selected",true)}}});$j("#bookacti-form-field-dialog-calendar").on("change","select#bookacti-activities",function(c){var b=$j(this).val();if(!b||(!$j.isArray(b)&&!$j.isNumeric(b))){return}if(!$j.isArray(b)){b=[b]}var a=$j(".bookacti-activities-actions-options-table tbody");$j.each(b,function(e,f){var d=$j("option#bookacti-activities_"+f).text();if(a.find('.bookacti-column-redirect_url input[name="redirect_url_by_activity['+f+']"]').length){var g=a.find('.bookacti-column-redirect_url input[name="redirect_url_by_activity['+f+']"]').closest("tr");g.data("activity_id",f);g.attr("data-activity_id",f);g.find(".bookacti-column-activity").text(d).attr("title",d);g.find(":input").prop("disabled",false);g.show();return true}else{a.find("tr:first").clone().appendTo(a);a.find("tr:last :input").each(function(){var i=$j(this).attr("name");var h=i.substring(0,i.lastIndexOf("["));$j(this).attr("name",h+"["+f+"]")});a.find("tr:last td.bookacti-column-activity").text(d).attr("title",d);a.find("tr:last :input").val("");a.find("tr:last").closest("tr").data("activity_id",f);a.find("tr:last").closest("tr").attr("data-activity_id",f)}});a.find("tr").each(function(){var e=$j(this);if(!e.data("activity_id")){$j(this).remove();return true}var d=e.data("activity_id");if($j.inArray(d,b)===-1){e.find(":input").prop("disabled",true);e.hide()}})});$j("#bookacti-form-field-dialog-calendar").on("change","select#bookacti-group_categories",function(d){var c=$j(this).val();var b=$j(".bookacti-group-categories-actions-options-table").is(":visible");if(c==="none"){$j(".bookacti-group-categories-actions-options-table").hide();$j(".bookacti-group-categories-actions-options-table :input").prop("disabled",true)}if(!c||(!$j.isArray(c)&&!$j.isNumeric(c))){return}if(!$j.isArray(c)){c=[c]}if(!b&&$j("select#bookacti-form_action").val()!=="default"){$j(".bookacti-group-categories-actions-options-table").show()}$j(".bookacti-group-categories-actions-options-table :input").prop("disabled",false);var a=$j(".bookacti-group-categories-actions-options-table tbody");$j.each(c,function(e,f){var g=$j("option#bookacti-group_categories_"+f).text();if(a.find('.bookacti-column-redirect_url input[name="redirect_url_by_group_category['+f+']"]').length){var h=a.find('.bookacti-column-redirect_url input[name="redirect_url_by_group_category['+f+']"]').closest("tr");h.data("category_id",f);h.attr("data-category_id",f);h.find(".bookacti-column-group_category").text(g).attr("title",g);h.find(":input").prop("disabled",false);h.show();return true}else{a.find("tr:first").clone().appendTo(a);a.find("tr:last :input").each(function(){var j=$j(this).attr("name");var i=j.substring(0,j.lastIndexOf("["));$j(this).attr("name",i+"["+f+"]")});a.find("tr:last td.bookacti-column-group_category").text(g).attr("title",g);a.find("tr:last :input").val("");a.find("tr:last").closest("tr").data("category_id",f);a.find("tr:last").closest("tr").attr("data-category_id",f)}});a.find("tr").each(function(){var f=$j(this);if(!f.data("category_id")){$j(this).remove();return true}var e=f.data("category_id");if($j.inArray(e,c)===-1){f.find(":input").prop("disabled",true);f.hide()}})});$j("#bookacti-form-field-dialog-calendar").on("change","select#bookacti-form_action",function(a){if($j(this).val()==="default"){$j(".bookacti-when-perform-form-action-container").hide()}else{$j(".bookacti-when-perform-form-action-container").show()}$j(".bookacti-activities-actions-options-table, .bookacti-group-categories-actions-options-table").show();if($j(this).val()==="default"){$j(".bookacti-activities-actions-options-table, .bookacti-group-categories-actions-options-table").hide()}else{if($j(this).val()==="redirect_to_url"){$j(".bookacti-activities-actions-options-table .bookacti-column-redirect_url, .bookacti-group-categories-actions-options-table .bookacti-column-redirect_url").show()}}if($j("select#bookacti-group_categories").val()==="none"){$j(".bookacti-group-categories-actions-options-table").hide()}});$j("#bookacti-form-editor").on("bookacti_field_updated bookacti_field_reset",function(g,d,f){if(f==="calendar"){var b=$j("#bookacti-form-editor-field-"+d+" .bookacti-booking-system");var a=b.attr("id");b.empty();bookacti_clear_booking_system_displayed_info(b);bookacti.booking_system[a]=[];bookacti.booking_system[a]=$j.extend(true,{},bookacti.form_editor.fields[d]);bookacti_reload_booking_system(b)}else{if(f==="login"){var c=$j("#bookacti-form-editor .bookacti-form-field-container.bookacti-form-field-type-login");bookacti_show_hide_register_fields(c)}}});$j("#bookacti-form-field-dialog-calendar").on("change","select#bookacti-form_action",function(a){$j(".bookacti-activities-actions-options-table .bookacti-column-product, .bookacti-group-categories-actions-options-table .bookacti-column-product").hide();if($j(this).val()==="redirect_to_product_page"||$j(this).val()==="add_product_to_cart"){$j(".bookacti-activities-actions-options-table .bookacti-column-redirect_url, .bookacti-group-categories-actions-options-table .bookacti-column-redirect_url").hide();$j(".bookacti-activities-actions-options-table .bookacti-column-product, .bookacti-group-categories-actions-options-table .bookacti-column-product").show()}if($j("select#bookacti-group_categories").val()==="none"){$j(".bookacti-group-categories-actions-options-table").hide()}});$j(window).on("beforeunload",function(a){if($j("#major-publishing-actions").data("popup")){return true}else{a=null}});window.onerror=function(e,b,a,d,c){$j("#bookacti-fatal-error").show()};$j("#bookacti-exit-loading").on("click",function(){bookacti_form_editor_exit_loading_state();var a=$j("#bookacti-booking-system-form-editor-container .bookacti-booking-system");if(a.length){bookacti_stop_loading_booking_system(a,true)}})});function bookacti_save_form(){$j("#bookacti-form-managers-select-box option").prop("selected",true);$j("#bookacti-form-editor-container").appendTo("#bookacti-form-editor-page-container");var a=$j("form#bookacti-form-editor-page-form");var c=a.find('input[name="is_active"]').val();var b=a.serialize();$j("#bookacti-form-editor-container").appendTo("#postdivrich");$j("#publishing-action .spinner").css("visibility","visible");bookacti_form_editor_enter_loading_state();$j.ajax({url:ajaxurl,data:b,type:"POST",dataType:"json",success:function(d){$j(".bookacti-form-notice").remove();if(d.status==="success"){$j("body").trigger("bookacti_form_updated");if(c==0){$j("#major-publishing-actions").data("popup",0);window.location.replace(a.attr("action")+"&notice=published")}else{$j("#bookacti-form-editor-page-container").before('<div class="notice notice-success is-dismissible bookacti-form-notice" ><p>'+d.message+"</p></div>")}}else{if(d.status==="failed"){var e=bookacti_localized.error_update_form;if(d.error==="not_allowed"){e+="\n"+bookacti_localized.error_not_allowed}$j("#bookacti-form-editor-page-container").before('<div class="notice notice-error is-dismissible bookacti-form-notice" ><p>'+e+"</p></div>");console.log(d)}}},error:function(f){var d="AJAX "+bookacti_localized.error_update_form;$j("#bookacti-form-editor-page-container").before('<div class="notice notice-error is-dismissible bookacti-form-notice" ><p>'+d+"</p></div>");console.log(f)},complete:function(){$j("#publishing-action .spinner").css("visibility","hidden");bookacti_form_editor_exit_loading_state()}})}function bookacti_save_form_field_order(){var a=$j("#bookacti-form-id").val();if(!$j.isNumeric(a)){return}var d=[];$j(".bookacti-form-editor-field").each(function(){d.push($j(this).data("field-id"))});if(!d.length){return}var b=$j("#bookacti_nonce_form_field_order").val();var c={action:"bookactiSaveFormFieldOrder",form_id:a,field_order:d,nonce:b};bookacti_form_editor_enter_loading_state();$j.ajax({url:ajaxurl,data:c,type:"POST",dataType:"json",success:function(e){if(e.status==="success"){bookacti.form_editor.form.field_order=e.field_order;$j("#bookacti-form-editor").trigger("bookacti_form_field_order_updated")}else{if(e.status==="failed"){var f=bookacti_localized.error_order_form_fields;if(e.error==="not_allowed"){f+="\n"+bookacti_localized.error_not_allowed}console.log(f);console.log(e)}}},error:function(g){var f="AJAX "+bookacti_localized.error_order_form_fields;console.log(f);console.log(g)},complete:function(){bookacti_form_editor_exit_loading_state()}})}function bookacti_form_editor_enter_loading_state(){$j(".bookacti-form-editor-action, .bookacti-form-editor-field-action").addClass("bookacti-disabled")}function bookacti_form_editor_exit_loading_state(){$j(".bookacti-form-editor-action, .bookacti-form-editor-field-action").removeClass("bookacti-disabled")};