function bookacti_init_form_editor_dialogs(){$j(".bookacti-form-dialog").dialog({modal:true,autoOpen:false,minHeight:300,minWidth:440,resize:"auto",show:true,hide:true,dialogClass:"bookacti-dialog",closeText:"&#10006;",close:function(){}});$j(".ui-widget-overlay").live("click",function(){$j("div:ui-dialog:visible").dialog("close")})}function bookacti_init_form_editor_actions(){$j("#bookacti-form-editor-actions").on("click",".bookacti-form-editor-action",function(a){if($j(this).is("#bookacti-insert-form-field")){bookacti_dialog_insert_form_field()}});$j("#bookacti-form-editor").on("click",".bookacti-form-editor-field-action",function(c){var b=$j(this).closest(".bookacti-form-editor-field").data("field-name");var a=$j(this).closest(".bookacti-form-editor-field").data("field-id");if($j(this).hasClass("bookacti-remove-form-field")){bookacti_dialog_remove_form_field(a,b)}if($j(this).hasClass("bookacti-edit-form-field")){bookacti_dialog_update_form_field(a,b)}})}function bookacti_dialog_insert_form_field(){$j("#bookacti-insert-form-field-dialog").dialog("open");$j("#bookacti-insert-form-field-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}},{text:bookacti_localized.dialog_button_ok,click:function(){var a=$j("#bookacti-form-id").val();var c=$j("#bookacti-field-to-insert").val();var b=$j("#nonce_insert_form_field").val();if(!c||!a||!b){return}bookacti_form_editor_enter_loading_state();$j.ajax({url:ajaxurl,type:"POST",data:{action:"bookactiInsertFormField",form_id:a,field_name:c,nonce:b},dataType:"json",success:function(e){if(e.status==="success"){$j("#bookacti-form-editor").append(e.field_html);bookacti.form_editor[e.field_id]=e.field_data;$j('#bookacti-field-to-insert option[value="'+c+'"][data-unique="1"]').attr("disabled",true);$j("#bookacti-field-to-insert").val($j("#bookacti-field-to-insert option:not([disabled]):first").val());$j("#bookacti-form-editor").trigger("bookacti_field_inserted",[e.field_id])}else{if(e.status==="failed"){var d=bookacti_localized.error_insert_form_field;if(e.error==="not_allowed"){d+="\n"+bookacti_localized.error_not_allowed}console.log(d);console.log(e)}}},error:function(d){console.log("AJAX "+bookacti_localized.error_insert_form_field);console.log(d)},complete:function(){bookacti_form_editor_exit_loading_state()}});$j(this).dialog("close")}}])}function bookacti_dialog_remove_form_field(a,b){$j("#bookacti-remove-form-field-dialog").dialog("open");$j("#bookacti-remove-form-field-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}},{text:bookacti_localized.dialog_button_ok,click:function(){var c=$j("#nonce_remove_form_field").val();if(!a||!c){return}bookacti_form_editor_enter_loading_state();$j.ajax({url:ajaxurl,type:"POST",data:{action:"bookactiRemoveFormField",field_id:a,nonce:c},dataType:"json",success:function(e){if(e.status==="success"){$j("#bookacti-form-editor-field-"+a).remove();delete bookacti.form_editor[a];$j('#bookacti-field-to-insert option[value="'+b+'"]').attr("disabled",false);$j("#bookacti-form-editor").trigger("bookacti_field_removed",[a])}else{if(e.status==="failed"){var d=bookacti_localized.error_remove_form_field;if(e.error==="not_allowed"){d+="\n"+bookacti_localized.error_not_allowed}console.log(d);console.log(e)}}},error:function(d){console.log("AJAX "+bookacti_localized.error_remove_form_field);console.log(d)},complete:function(){bookacti_form_editor_exit_loading_state()}});$j(this).dialog("close")}}])}function bookacti_dialog_update_form_field(a,b){$j("form#bookacti-form-field-form-"+b+' input[name="field_id"]').val(a);$j("#bookacti-form-field-dialog-"+b).dialog("open");$j("#bookacti-form-field-dialog-"+b).dialog("option","buttons",[{text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}},{text:bookacti_localized.dialog_button_ok,click:function(){var c=$j("form#bookacti-form-field-form-"+b).serializeObject();console.log(c);bookacti_form_editor_enter_loading_state();$j.ajax({url:ajaxurl,type:"POST",data:c,dataType:"json",success:function(e){if(e.status==="success"){if(b==="calendar"){}else{$j("#bookacti-form-editor-field-"+a).replaceWith(e.field_html);bookacti.form_editor[a]=e.field_data}bookacti_init_tooltip();$j("#bookacti-form-editor").trigger("bookacti_field_updated",[a])}else{if(e.status==="failed"){var d=bookacti_localized.error_update_form_field;if(e.error==="not_allowed"){d+="\n"+bookacti_localized.error_not_allowed}console.log(d);console.log(e)}}},error:function(d){console.log("AJAX "+bookacti_localized.error_update_form_field);console.log(d)},complete:function(){bookacti_form_editor_exit_loading_state()}});$j(this).dialog("close")}}])};