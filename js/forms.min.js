$j(document).ready(function(){if(!$j("form#bookacti-form-editor-page-form").length){return}bookacti_init_add_and_remove_items();$j(".bookacti-form-editor-field-header").on("click",function(){var c=$j(this).find(".bookacti-field-toggle");c.toggleClass("dashicons-arrow-up dashicons-arrow-down");c.closest(".bookacti-form-editor-field").find(".bookacti-form-editor-field-body").toggle();var b=c.closest(".bookacti-form-editor-field").find(".bookacti-form-editor-field-body").is(":visible");var a=c.closest(".bookacti-form-editor-field").find(".bookacti-booking-system");if(b&&a.length){bookacti_booking_method_rerender_events(a)}});$j(".bookacti-edit-form-field").on("click",function(a){a.stopPropagation()});$j(".bookacti-remove-form-field").on("click",function(a){a.stopPropagation()});$j("#bookacti-form-editor").sortable({items:".bookacti-form-editor-field:not(.ui-state-disabled)",handle:".bookacti-form-editor-field-header",placeholder:"bookacti-form-editor-field-placeholder",update:function(b,a){bookacti_save_form_field_order()}});$j("#bookacti-form-editor").disableSelection();$j("form#bookacti-form-editor-page-form").on("submit",function(a){a.preventDefault();bookacti_save_form($j(this))})});function bookacti_save_form(a){$j("#bookacti-form-managers-select-box option").attr("selected",true);var c=a.find('input[name="action"]').val();var b=a.serialize();$j("#publishing-action .spinner").css("visibility","visible");$j.ajax({url:ajaxurl,data:b,type:"POST",dataType:"json",success:function(d){$j(".bookacti-form-notice").remove();if(d.status==="success"){if(c==="bookactiInsertForm"){window.location.replace(a.attr("action")+"&action=edit&form_id="+d.form_id+"&notice=created")}else{$j("#bookacti-form-editor-page-container").before('<div class="notice notice-success is-dismissible bookacti-form-notice" ><p>'+d.message+"</p></div>")}}else{if(d.status==="failed"){var e=c==="bookactiInsertForm"?bookacti_localized.error_create_form:bookacti_localized.error_update_form;if(d.error==="not_allowed"){e+="\n"+bookacti_localized.error_not_allowed}$j("#bookacti-form-editor-page-container").before('<div class="notice notice-error is-dismissible bookacti-form-notice" ><p>'+e+"</p></div>");console.log(d)}}},error:function(f){var d=c==="bookactiInsertForm"?"AJAX "+bookacti_localized.error_create_form:"AJAX "+bookacti_localized.error_update_form;$j("#bookacti-form-editor-page-container").before('<div class="notice notice-error is-dismissible bookacti-form-notice" ><p>'+d+"</p></div>");console.log(f)},complete:function(){$j("#publishing-action .spinner").css("visibility","hidden")}})}function bookacti_save_form_field_order(){var a=$j("#bookacti-form-id").val();if(!$j.isNumeric(a)){return}var d=[];$j(".bookacti-form-editor-field").each(function(){d.push($j(this).data("field-name"))});if(!d.length){return}var b=$j("#bookacti_nonce_form_field_order").val();var c={action:"bookactiSaveFormFieldOrder",form_id:a,field_order:d,nonce:b};console.log(c);$j.ajax({url:ajaxurl,data:c,type:"POST",dataType:"json",success:function(e){$j(".bookacti-form-notice").remove();if(e.status==="success"){}else{if(e.status==="failed"){var f=bookacti_localized.error_order_form_fields;if(e.error==="not_allowed"){f+="\n"+bookacti_localized.error_not_allowed}console.log(e)}}},error:function(g){var f="AJAX "+bookacti_localized.error_order_form_fields;console.log(g)},complete:function(){$j("#publishing-action .spinner").css("visibility","hidden")}})};