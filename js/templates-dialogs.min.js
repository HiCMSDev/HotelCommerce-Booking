function bookacti_init_template_dialogs(){$j(".bookacti-template-dialogs").dialog({modal:true,autoOpen:false,minHeight:300,minWidth:520,resize:"auto",show:true,hide:true,closeText:"&#10006;",beforeClose:function(){bookacti_empty_all_dialog_forms()}});$j(".bookacti-template-dialogs").on("keydown",function(a){if(a.keyCode==$j.ui.keyCode.ENTER){$j(this).parent().find(".ui-dialog-buttonpane button:first").focus();return false}});$j("#bookacti-activity-create-method-dialog").dialog({title:bookacti_localized.dialog_choice_activity_title});$j("#bookacti-activity-import-dialog").dialog({title:bookacti_localized.dialog_import_activity_title});$j("#bookacti-delete-event-dialog").dialog({title:bookacti_localized.dialog_delete_event_title});$j("#bookacti-delete-booked-event-dialog").dialog({title:bookacti_localized.dialog_delete_booked_event_title});$j("#bookacti-event-data-dialog").dialog({title:bookacti_localized.dialog_update_event_title});$j("#bookacti-delete-template-dialog").dialog({title:bookacti_localized.dialog_delete_template_title});$j("#bookacti-delete-activity-dialog").dialog({title:bookacti_localized.dialog_delete_activity_title});$j("#bookacti-unbind-booked-event-dialog").dialog({title:bookacti_localized.dialog_locked_event,beforeClose:function(){}});$j("#bookacti-group-of-events-dialog").dialog({title:bookacti_localized.dialog_create_group_of_events_title});$j("#bookacti-delete-group-of-events-dialog").dialog({title:bookacti_localized.dialog_delete_group_of_events_title});$j("#bookacti-group-category-dialog").dialog({title:bookacti_localized.dialog_update_group_category_title});$j("#bookacti-delete-group-category-dialog").dialog({title:bookacti_localized.dialog_delete_group_category_title});bookacti_init_add_and_remove_items();$j("select#template-import-bound-activities").on("change",function(){bookacti_load_activities_bound_to_template($j("select#template-import-bound-activities").val())});$j("#bookacti-template-container").on("click","#bookacti-insert-template img, #bookacti-add-first-template-button img",function(){bookacti_dialog_add_new_template()});$j("#bookacti-template-activity-list").on("click",".activity-gear img",function(){var a=$j(this).data("activity-id");bookacti_dialog_update_activity(a)});$j("#bookacti-template-groups-of-events-container").on("click","#bookacti-template-add-first-group-of-events-button img, #bookacti-insert-group-of-events img",function(){bookacti_dialog_create_group_of_events()});$j(document).on("keydown",function(a){if(a.ctrlKey&&a.keyCode==71){a.preventDefault();a.stopPropagation();if(bookacti.booking_system["bookacti-template-calendar"]["selected_events"].length>=2){bookacti_dialog_create_group_of_events()}}});$j("#bookacti-template-groups-of-events-container").on("click",".bookacti-group-of-events-title, .bookacti-update-group-of-events img",function(){var a=$j(this).parents(".bookacti-group-of-events").data("group-id");bookacti_update_group_of_events(a)});$j("#bookacti-group-categories").on("click",".bookacti-update-group-category img",function(){var a=$j(this).parents(".bookacti-group-category").data("group-category-id");bookacti_dialog_update_group_category(a)});$j(".bookacti-backend-dialog form").on("submit",function(a){a.preventDefault()});$j("#bookacti-group-of-events-category-selectbox").on("change blur",function(){if($j(this).val()==="new"){$j("#bookacti-group-of-events-new-category-title").show()}else{$j("#bookacti-group-of-events-new-category-title").hide()}})}function bookacti_dialog_add_new_template(){$j("#bookacti-template-data-dialog").dialog({title:bookacti_localized.dialog_create_template_title});$j("#bookacti-template-opening").val(moment().format("YYYY-MM-DD"));$j("#bookacti-template-closing").val(moment().add(7,"days").format("YYYY-MM-DD"));$j("#bookacti-template-data-minTime").val("08:00");$j("#bookacti-template-data-maxTime").val("20:00");$j("#badp-template-data-snapDuration").val("00:30");$j("#bookacti-template-data-dialog").trigger("bookacti_default_template_settings");if($j("#bookacti-template-duplicated-template-id option").length>1){$j("#bookacti-duplicate-template-fields").show();$j("#bookacti-template-duplicated-template-id").attr("disabled",false);$j("#bookacti-template-duplicated-template-id").off().on("change blur",function(){var c=$j("#bookacti-template-duplicated-template-id").val();if(c){var a=$j('#bookacti-template-picker option[value="'+c+'"]').data("template-start");var b=$j('#bookacti-template-picker option[value="'+c+'"]').data("template-end");if(a&&b){if(a.length&&b.length){$j("#bookacti-template-opening").val(a);$j("#bookacti-template-closing").val(b)}}}})}else{$j("#bookacti-duplicate-template-fields").hide();$j("#bookacti-template-duplicated-template-id").attr("disabled",true)}$j("#bookacti-template-data-dialog").dialog("open");$j("#bookacti-template-data-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){$j("#bookacti-template-data-form-action").val("bookactiInsertTemplate");$j("#bookacti-template-data-form select[multiple] option").attr("selected",true);var e=$j("#bookacti-template-title").val();var f=moment($j("#bookacti-template-opening").val(),["MM-DD-YYYY","DD-MM-YYYY","YYYY-MM-DD"]).format("YYYY-MM-DD");var a=moment($j("#bookacti-template-closing").val(),["MM-DD-YYYY","DD-MM-YYYY","YYYY-MM-DD"]).format("YYYY-MM-DD");var b=$j("#bookacti-template-duplicated-template-id").val();var c=$j("#bookacti-template-data-form").serialize();var d=bookacti_validate_template_form();if(d){if($j("#bookacti-template-calendar").length){bookacti_start_template_loading()}else{if($j("#bookacti-first-template-container").length){$j("#bookacti-add-first-template-button img").attr("src",bookacti_localized.plugin_path+"/img/ajax-loader.gif")}}$j.ajax({url:ajaxurl,data:c,type:"POST",dataType:"json",success:function(g){if(g.status==="success"){if($j("#bookacti-first-template-container").length){$j("#bookacti-first-template-container").before($j('<div id="bookacti-template-calendar" ></div>'));$j("#bookacti-first-template-container").remove();$j(".bookacti-no-template").removeClass("bookacti-no-template");bookacti_load_template_calendar();bookacti_start_template_loading()}$j("#bookacti-template-picker").append("<option value='"+g.template_id+"' data-template-start='"+f+"' data-template-end='"+a+"' >"+e+"</option>");$j("select.bookacti-template-select-box").append("<option value='"+g.template_id+"' >"+e+"</option>");if($j("#bookacti-template-picker option").length===2){bookacti_bind_template_dialogs()}$j("#bookacti-template-picker").val(g.template_id).trigger("change")}else{if(g.status==="failed"){var h=bookacti_localized.error_create_template;if(g.error==="not_allowed"){h+="\n"+bookacti_localized.error_not_allowed}alert(h);console.log(g)}}},error:function(g){alert("AJAX "+bookacti_localized.error_create_template);console.log(g)},complete:function(){if($j("#bookacti-first-template-container").length){$j("#bookacti-add-first-template-button img").attr("src",bookacti_localized.plugin_path+"/img/add.png")}bookacti_stop_template_loading()}});$j(this).dialog("close")}}}])}function bookacti_dialog_update_template(a){if(!a){return false}$j("#bookacti-template-data-dialog").dialog({title:bookacti_localized.dialog_update_template_title});$j("#bookacti-duplicate-template-fields").hide();$j("#bookacti-template-duplicated-template-id").attr("disabled",true);bookacti_start_template_loading();$j.ajax({url:ajaxurl,data:{action:"bookactiGetTemplateData",template_id:a,nonce:bookacti_localized.nonce_get_template_data},type:"POST",dataType:"json",success:function(c){if(c.status==="success"){var e=c.title?c.title:$j('#bookacti-template-picker option[value="'+a+'"]').html();var f=c.start_date?c.start_date:$j('#bookacti-template-picker option[value="'+a+'"]').data("template-start");var b=c.end_date?c.end_date:$j('#bookacti-template-picker option[value="'+a+'"]').data("template-end");$j("#bookacti-template-title").val(e);$j("#bookacti-template-opening").val(f);$j("#bookacti-template-closing").val(b);if(c.admin){$j.each(c.admin,function(g,h){$j('#bookacti-add-new-template-managers-select-box option[value="'+h+'"]').clone().appendTo("#bookacti-template-managers-select-box");$j('#bookacti-add-new-template-managers-select-box option[value="'+h+'"]').hide().attr("disabled",true);if($j("#bookacti-add-new-template-managers-select-box").val()==h||!$j("#bookacti-add-new-template-managers-select-box").val()){$j("#bookacti-add-new-template-managers-select-box").val($j("#bookacti-add-new-template-managers-select-box option:enabled:first").val())}})}$j("#bookacti-template-data-dialog").trigger("bookacti_default_template_settings");if(c.settings){bookacti_fill_settings_fields(c.settings,"templateOptions")}}else{var d=bookacti_localized.error_retrieve_template_data;if(c.error==="not_allowed"){d+="\n"+bookacti_localized.error_not_allowed}alert(d);console.log(c)}},error:function(b){alert("AJAX "+bookacti_localized.error_retrieve_template_data);console.log(b)},complete:function(){bookacti_stop_template_loading();$j("#bookacti-template-data-dialog").dialog("open")}});$j("#bookacti-template-data-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){$j("#bookacti-template-data-form-template-id").val(a);$j("#bookacti-template-data-form-action").val("bookactiUpdateTemplate");$j("#bookacti-template-data-form select[multiple] option").attr("selected",true);var f=$j("#bookacti-template-title").val();var g=moment($j("#bookacti-template-opening").val(),["MM-DD-YYYY","DD-MM-YYYY","YYYY-MM-DD"]).format("YYYY-MM-DD");var b=moment($j("#bookacti-template-closing").val(),["MM-DD-YYYY","DD-MM-YYYY","YYYY-MM-DD"]).format("YYYY-MM-DD");var d=$j("#bookacti-template-data-form").serialize();var c=$j("#bookacti-template-data-form").serializeObject();if(c.templateOptions){c=c.templateOptions}else{c.templateOptions={}}var e=bookacti_validate_template_form();if(e){bookacti_start_template_loading();$j.ajax({url:ajaxurl,data:d,type:"POST",dataType:"json",success:function(j){if(j.status==="success"){$j("#bookacti-template-picker option[value="+a+"]").html(f);$j("#bookacti-template-picker option[value="+a+"]").data("template-start",g);$j("#bookacti-template-picker option[value="+a+"]").data("template-end",b);$j("#bookacti-template-picker option[value="+a+"]").attr("data-template-start",g);$j("#bookacti-template-picker option[value="+a+"]").attr("data-template-end",b);c.start=g;c.end=b;bookacti_update_calendar_settings($j("#bookacti-template-calendar"),c);var h=moment($j("#bookacti-template-picker :selected").data("template-start"));var i=moment($j("#bookacti-template-picker :selected").data("template-end"));bookacti_set_valid_range($j("#bookacti-template-calendar"),h,i)}else{if(j.status==="nochanges"){}else{var k=bookacti_localized.error_update_template;if(j.errors){if(j.errors.length){$j.each(j.errors,function(m,l){k+="\n\u00B7 "+bookacti_localized[l];if(j.error==="not_allowed"){k+="\n"+bookacti_localized.error_not_allowed+"\n"}})}alert(k);console.log(j)}}}},error:function(h){alert("AJAX "+bookacti_localized.error_update_template);console.log(h)},complete:function(){bookacti_stop_template_loading()}});$j(this).dialog("close")}}},{text:bookacti_localized.dialog_button_delete,"class":"bookacti-dialog-delete-button bookacti-dialog-left-button",click:function(){bookacti_dialog_deactivate_template(a)}}])}function bookacti_dialog_deactivate_template(a){if(!a){return false}$j("#bookacti-delete-template-dialog").dialog("open");$j("#bookacti-delete-template-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_delete,"class":"bookacti-dialog-delete-button",click:function(){bookacti_start_template_loading();$j.ajax({url:ajaxurl,data:{action:"bookactiDeactivateTemplate",template_id:a,nonce:bookacti_localized.nonce_deactivate_template},type:"POST",dataType:"json",success:function(c){if(c.status==="success"){$j("#bookacti-template-picker option[value="+a+"]").remove();var b=$j("#bookacti-template-picker option:first").val();$j("select.bookacti-template-select-box option[value="+a+"]").remove();if($j("#bookacti-template-picker option").length===1){bookacti_bind_template_dialogs()}bookacti_switch_template(b)}else{var d=bookacti_localized.error_delete_template;if(c.error==="not_allowed"){d+="\n"+bookacti_localized.error_not_allowed}alert(d);console.log(c)}},error:function(b){alert("AJAX "+bookacti_localized.error_delete_template);console.log(b)},complete:function(){bookacti_stop_template_loading()}});$j(this).dialog("close");$j("#bookacti-template-data-dialog").dialog("close")}},{text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}}])}function bookacti_dialog_update_event(a){$j("#bookacti-event-data-dialog").data("event-id",a.id);$j("#bookacti-event-data-dialog").attr("data-event-id",a.id);bookacti_start_template_loading();$j.ajax({url:ajaxurl,data:{action:"bookactiGetEventData",event_id:a.id,nonce:bookacti_localized.nonce_get_event_data},type:"POST",dataType:"json",success:function(f){if(f.status==="success"){var b=a.start;var m=moment(b).add(28,"d");var d=$j("#bookacti-template-picker :selected").data("template-start");var c=$j("#bookacti-template-picker :selected").data("template-end");var h=b.format("YYYY-MM-DD");var g=m.isBefore(moment(c))?m.format("YYYY-MM-DD"):c;if(f.repeat_from&&f.repeat_from!=="0000-00-00"){h=f.repeat_from}if(f.repeat_to&&f.repeat_to!=="0000-00-00"){g=f.repeat_to}$j("#bookacti-event-title").val(f.title);$j("#bookacti-event-availability").val(f.availability);$j("#bookacti-event-availability").attr("min",f.min_availability);$j('#bookacti-event-repeat-freq option[value="'+f.repeat_freq+'"]').prop("selected",true);$j("#bookacti-event-repeat-freq").data("initial-freq",f.repeat_freq);$j("#bookacti-event-repeat-freq").attr("data-initial-freq",f.repeat_freq);$j("#bookacti-event-repeat-from, #bookacti-event-repeat-to").attr("min",d);$j("#bookacti-event-repeat-from, #bookacti-event-repeat-to").attr("max",c);$j("#bookacti-event-repeat-from").val(h);$j("#bookacti-event-repeat-to").val(g);$j("#bookacti-event-exception-date-picker").val(h);$j("#bookacti-event-exception-date-picker").attr("min",h);$j("#bookacti-event-exception-date-picker").attr("max",g);if(f.is_bookings){$j("#bookacti-event-repeat-from").attr("max",f.max_from);$j("#bookacti-event-repeat-to").attr("min",f.min_to)}if(f.exceptions.length>0){$j.each(f.exceptions,function(n,o){$j("#bookacti-event-exceptions-selectbox").append("<option class='exception' value='"+o.exception_value+"' >"+o.exception_value+"</option>")})}if(f.settings){bookacti_fill_settings_fields(f.settings,"eventOptions")}if(bookacti_localized.is_qtranslate){$j("#bookacti-event-data-dialog .qtranxs-translatable").each(function(){bookacti_refresh_qtx_field(this)})}bookacti_validate_event_general_data();bookacti_validate_event_repetition_data(a);var i=[];var l={text:bookacti_localized.dialog_button_ok,click:function(){$j("#bookacti-event-data-form-event-id").val(a.id);$j("#bookacti-event-data-form-event-start").val(a.start.format("YYYY-MM-DD HH:mm:ss"));$j("#bookacti-event-data-form-event-end").val(a.end.format("YYYY-MM-DD HH:mm:ss"));$j("#bookacti-event-data-form-action").val("bookactiUpdateEventData");$j("#bookacti-event-data-form select[multiple] option").attr("selected",true);var p=$j("#bookacti-event-data-form").serialize();var n=a;n.title=$j("#bookacti-event-title").val();var o={availability:$j("#bookacti-event-availability").val(),repeat_freq:$j("#bookacti-event-repeat-freq").val(),repeat_from:$j("#bookacti-event-repeat-from").val(),repeat_to:$j("#bookacti-event-repeat-to").val()};var q=$j("#bookacti-event-exceptions-selectbox").val()?$j("#bookacti-event-exceptions-selectbox").val():[];var r=bookacti_validate_event_form(a);if(r){bookacti_start_template_loading();$j.ajax({url:ajaxurl,data:p,type:"POST",dataType:"json",success:function(s){if(s.status==="success"){bookacti_unselect_event(a,undefined,true);bookacti.booking_system["bookacti-template-calendar"]["events_data"][a.id]["title"]=n.title;bookacti.booking_system["bookacti-template-calendar"]["events_data"][a.id]["availability"]=o.availability;bookacti.booking_system["bookacti-template-calendar"]["events_data"][a.id]["repeat_freq"]=o.repeat_freq;bookacti.booking_system["bookacti-template-calendar"]["events_data"][a.id]["repeat_from"]=o.repeat_from;bookacti.booking_system["bookacti-template-calendar"]["events_data"][a.id]["repeat_to"]=o.repeat_to;bookacti.booking_system["bookacti-template-calendar"]["groups_events"]=s.groups_events;bookacti.booking_system["bookacti-template-calendar"]["exceptions"][a.id]=[];$j.each(q,function(u,v){bookacti.booking_system["bookacti-template-calendar"]["exceptions"][a.id].push({exception_type:"date",exception_value:v})});bookacti_clear_events_on_calendar($j("#bookacti-template-calendar"),a);if(o.repeat_freq!=="none"){bookacti_display_repeated_events($j("#bookacti-template-calendar"),[n])}else{$j("#bookacti-template-calendar").fullCalendar("addEventSource",[n])}$j("#bookacti-template-calendar").fullCalendar("rerenderEvents")}else{if(s.status==="nochanges"){}else{if(s.status==="failed"){alert(bookacti_localized.error_update_event_param);var t="";t+="Status : "+s.status+"\n";t+="Update event : "+s.updated_event+"\n";t+="Update event meta : "+s.updated_event_meta+"\n";t+="Insert excep : "+s.inserted_excep+"\n";t+="Delete excep : "+s.deleted_excep;console.log(t);console.log(s)}else{if(s.status==="not_valid"){if(s.errors.length){var t="";$j.each(s.errors,function(v,u){t+="\u00B7 "+bookacti_localized[u]+"\n"});t+="\n"+bookacti_localized.advice_switch_to_maintenance;alert(t);console.log(s)}else{alert(bookacti_localized.error_update_event_param);console.log(s)}}else{if(s.status==="not_allowed"){alert(bookacti_localized.error_update_event_param+"\n"+bookacti_localized.error_not_allowed);console.log(bookacti_localized.error_update_event_param+" "+bookacti_localized.error_not_allowed);console.log(s)}else{console.log(s);alert(bookacti_localized.error_update_event_param)}}}}}},error:function(s){alert("AJAX "+bookacti_localized.error_update_event_param);console.log(s)},complete:function(){bookacti_stop_template_loading()}});$j(this).dialog("close")}}};i.push(l);var j={text:bookacti_localized.dialog_button_delete,"class":"bookacti-dialog-delete-button bookacti-dialog-left-button",click:function(){bookacti_dialog_delete_event(a)}};i.push(j);var e={};if(f.repeat_freq!=="none"){e={text:bookacti_localized.dialog_button_unbind,"class":"bookacti-dialog-unbind-button bookacti-dialog-left-button",click:function(){bookacti_dialog_unbind_occurences(a)}};i.push(e)}$j("#bookacti-event-data-dialog").dialog("option","buttons",i)}else{if(f.status==="failed"){var k=bookacti_localized.error_retrieve_event_data;if(f.error==="not_allowed"){k+="\n"+bookacti_localized.error_not_allowed}console.log(f);alert(k)}}},error:function(b){alert("AJAX "+bookacti_localized.error_retrieve_event_data);console.log(b)},complete:function(){bookacti_stop_template_loading();$j("#bookacti-event-data-dialog").dialog("open")}})}function bookacti_dialog_delete_event(a){$j("#bookacti-delete-event-dialog").dialog("open");$j("#bookacti-delete-event-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_delete,"class":"bookacti-dialog-delete-button",click:function(){bookacti_start_template_loading();$j.ajax({url:ajaxurl,data:{action:"bookactiDeleteEvent",event_id:a.id,nonce:bookacti_localized.nonce_delete_event},type:"POST",dataType:"json",success:function(b){if(b.status==="success"){bookacti_delete_event(a)}else{if(b.error==="has_bookings"){if(!a.bookings){bookacti_refresh_booking_numbers("bookacti-template-calendar",a.id)}var d=bookacti.booking_system["bookacti-template-calendar"]["events_data"][a.id]["repeat_freq"];if(d!=="none"){bookacti_dialog_unbind_occurences(a,["delete"])}else{bookacti_dialog_delete_booked_event(a)}}else{var c=bookacti_localized.error_delete_event;if(b.error==="not_allowed"){c+="\n"+bookacti_localized.error_not_allowed}alert(c);console.log(b)}}},error:function(b){alert("AJAX "+bookacti_localized.error_delete_event);console.log(b)},complete:function(){bookacti_stop_template_loading()}});$j(this).dialog("close");$j("#bookacti-event-data-dialog").dialog("close")}},{text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}}])}function bookacti_dialog_delete_booked_event(a){$j("#bookacti-delete-booked-event-dialog").dialog("open");$j("#bookacti-delete-booked-event-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_delete,"class":"bookacti-dialog-delete-button",click:function(){bookacti_start_template_loading();$j.ajax({url:ajaxurl,data:{action:"bookactiDeleteEventForced",event_id:a.id,nonce:bookacti_localized.nonce_delete_event_forced},type:"POST",dataType:"json",success:function(b){if(b.status==="success"){bookacti_delete_event(a)}else{var c=bookacti_localized.error_delete_event;if(b.error==="not_allowed"){c+="\n"+bookacti_localized.error_not_allowed}alert(c);console.log(b)}},error:function(b){alert("AJAX "+bookacti_localized.error_delete_event);console.log(b)},complete:function(){bookacti_stop_template_loading()}});$j(this).dialog("close");$j("#bookacti-event-data-dialog").dialog("close")}},{text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}}])}function bookacti_dialog_unbind_occurences(d,f){f=f||[];$j("#bookacti-unbind-booked-event-dialog").dialog("open");if(f.length>0){$j("#bookacti-unbind-booked-event-error-list-container ul").empty();$j.each(f,function(h,g){if(g==="move"){$j("#bookacti-unbind-booked-event-error-list-container ul").append("<li>"+bookacti_localized.error_move_locked_event+"</li>")}if(g==="resize"){$j("#bookacti-unbind-booked-event-error-list-container ul").append("<li>"+bookacti_localized.error_resize_locked_event+"</li>")}if(g==="delete"){$j("#bookacti-unbind-booked-event-error-list-container ul").append("<li>"+bookacti_localized.error_delete_locked_event+"</li>")}});$j("#bookacti-unbind-booked-event-error-list-container").show()}else{$j("#bookacti-unbind-booked-event-error-list-container").hide()}var e={text:bookacti_localized.dialog_button_unbind_selected,"class":"bookacti-dialog-delete-button",click:function(){bookacti_unbind_occurrences(d,"selected");$j("#bookacti-event-data-dialog").dialog("close")}};var a={text:bookacti_localized.dialog_button_unbind_all_booked,"class":"bookacti-dialog-delete-button",click:function(){bookacti_unbind_occurrences(d,"booked");$j("#bookacti-event-data-dialog").dialog("close")}};var b={text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}};var c=[e,a,b];$j("#bookacti-unbind-booked-event-dialog").dialog("option","buttons",c)}function bookacti_dialog_choose_activity_creation_type(){if(!bookacti.selected_template){return false}var a={text:bookacti_localized.dialog_button_create_activity,click:function(){$j(this).dialog("close");bookacti_dialog_create_activity()}};var d={text:bookacti_localized.dialog_button_import_activity,click:function(){$j(this).dialog("close");bookacti_dialog_import_activity()}};var b={text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}};var c=[a,d,b];if($j("#bookacti-template-picker option").length<=1){c.unshift(d)}$j("#bookacti-activity-create-method-dialog").dialog("option","buttons",c);$j("#bookacti-activity-create-method-dialog").dialog("open")}function bookacti_dialog_import_activity(){if(!bookacti.selected_template){return false}$j("#bookacti-activity-import-dialog").dialog("open");$j("#template-import-bound-activities option").attr("disabled",false);$j('#template-import-bound-activities option[value="'+bookacti.selected_template+'"]').attr("disabled",true);$j("#template-import-bound-activities").children("option:enabled").eq(0).prop("selected",true);$j("#template-import-bound-activities").trigger("change");$j("#bookacti-activity-import-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){$j("#bookacti-activity-import-dialog .input-error").removeClass("input-error");$j("#bookacti-activity-import-dialog .form-error").remove();var a=$j("select#activities-to-import").val();if(!$j.isEmptyObject(a)){bookacti_start_template_loading();$j.ajax({url:ajaxurl,data:{action:"bookactiImportActivities",activity_ids:a,template_id:bookacti.selected_template,nonce:bookacti_localized.nonce_import_activity},type:"POST",dataType:"json",success:function(b){if(b.status==="success"){bookacti.booking_system["bookacti-template-calendar"]["activities_data"]=b.activities_data;var e=bookacti_localized.plugin_path;var d="";$j.each(a,function(f,g){d+="<div class='activity-row'><div class='activity-show-hide' ><img src='"+e+"/img/show.png' data-activity-id='"+g+"' data-activity-visible='1' /></div><div class='activity-container'><div class='fc-event ui-draggable ui-draggable-handle' data-title='"+$j('select#activities-to-import option[value="'+g+'"]').attr("data-title")+"' data-activity-id='"+g+"' data-color='"+$j('select#activities-to-import option[value="'+g+'"]').attr("data-color")+"' data-availability='"+$j('select#activities-to-import option[value="'+g+'"]').attr("data-availability")+"' data-duration='"+$j('select#activities-to-import option[value="'+g+'"]').attr("data-duration")+"' data-resizable='"+$j('select#activities-to-import option[value="'+g+'"]').attr("data-resizable")+"' >"+$j('select#activities-to-import option[value="'+g+'"]').html()+"</div></div><div class='activity-gear' ><img src='"+e+"/img/gear.png' data-activity-id='"+g+"' /></div></div>";$j('select#activities-to-import option[value="'+g+'"]').remove()});$j("#bookacti-template-activity-list").append(d);bookacti_init_activities();bookacti_update_shortcode_generator_activity_ids(a,true,false);$j("#bookacti-activity-import-dialog").dialog("close");$j("#bookacti-activity-create-method-dialog").dialog("close")}else{if(b.status==="no_activity"){$j("#activities-to-import").addClass("input-error");$j("#bookacti-activities-bound-to-template").append('<div class="form-error" >'+bookacti_localized.error_no_activity_selected+"</div>")}else{var c=bookacti_localized.error_import_activity;if(b.error==="not_allowed"){c+="\n"+bookacti_localized.error_not_allowed}alert(c);console.log(b)}}},error:function(b){alert("AJAX "+bookacti_localized.error_import_activity);console.log(b)},complete:function(){bookacti_stop_template_loading()}})}else{$j("#activities-to-import").addClass("input-error");$j("#bookacti-activities-bound-to-template").append('<div class="form-error" >'+bookacti_localized.error_no_activity_selected+"</div>")}}},{text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}}])}function bookacti_dialog_create_activity(){if(!bookacti.selected_template){return false}$j("#bookacti-activity-data-dialog").dialog({title:bookacti_localized.dialog_create_activity_title});$j("#bookacti-activity-template-id").val(bookacti.selected_template);$j("#bookacti-activity-activity-id").val("");$j("#bookacti-activity-action").val("bookactiInsertActivity");$j("#bookacti-activity-old-title").val("");if((!$j("#bookacti-activity-templates-select-box").val()||$j.inArray(bookacti.selected_template,$j("#bookacti-activity-templates-select-box").val())===-1)&&$j('#bookacti-add-new-activity-templates-select-box option[value="'+bookacti.selected_template+'"]').length){$j("#bookacti-add-new-activity-templates-select-box").val(bookacti.selected_template);$j("#bookacti-activity-templates-container .bookacti-add-items").trigger("click")}$j("#bookacti-activity-data-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){if(!$j("#bookacti-activity-templates-select-box").val()){}$j("#bookacti-activity-data-form select[multiple] option").attr("selected",true);var h=$j("#bookacti-activity-title").val();var f=$j("#bookacti-activity-color").val();var c=$j("#bookacti-activity-availability").val();var j=$j("#bookacti-activity-duration-days").val();var i=$j("#bookacti-activity-duration-hours").val();var e=$j("#bookacti-activity-duration-minutes").val();var d=bookacti_pad(j,3)+"."+bookacti_pad(i,2)+":"+bookacti_pad(e,2)+":00";var a=$j("#bookacti-activity-resizable").prop("checked");if(a){a="1"}else{a="0"}a=a.toString();$j("#bookacti-activity-duration").val(d);var g=$j("#bookacti-activity-data-form").serialize();var b=bookacti_validate_activity_form();if(b){bookacti_start_template_loading();$j.ajax({url:ajaxurl,data:g,type:"POST",dataType:"json",success:function(k){var m=bookacti_localized.plugin_path;if(k.status==="success"){bookacti.booking_system["bookacti-template-calendar"]["activities_data"][k.activity_id]=k.activity_data;if($j.inArray(bookacti.selected_template+"",k.templates)!==-1||$j.inArray(bookacti.selected_template,k.templates)!==-1){$j("#bookacti-template-activity-list").append("<div class='activity-row'><div class='activity-show-hide' ><img src='"+m+"/img/show.png' data-activity-id='"+k.activity_id+"' data-activity-visible='1' /></div><div class='activity-container'><div class='fc-event ui-draggable ui-draggable-handle' data-title='"+k.multilingual_title+"' data-activity-id='"+k.activity_id+"' data-color='"+f+"' data-availability='"+c+"' data-duration='"+d+"' data-resizable='"+a+"' >"+k.title+"</div></div><div class='activity-gear' ><img src='"+m+"/img/gear.png' data-activity-id='"+k.activity_id+"' /></div></div>");bookacti_init_activities();bookacti_update_shortcode_generator_activity_ids(k.activity_id,true,false)}else{alert(bookacti_localized.advice_activity_created_elsewhere);console.log(k)}}else{if(k.status==="failed"){var l=bookacti_localized.error_create_activity;if(k.error==="not_allowed"){l+="\n"+bookacti_localized.error_not_allowed}else{if(k.error==="no_templates"){l+="\n"+bookacti_localized.error_no_templates_for_activity}}alert(l);console.log(k)}}},error:function(k){alert("AJAX "+bookacti_localized.error_create_activity);console.log(k)},complete:function(){bookacti_stop_template_loading()}});$j("#bookacti-activity-data-dialog").dialog("close");$j("#bookacti-activity-create-method-dialog").dialog("close")}}}]);$j("#bookacti-activity-data-dialog").dialog("open")}function bookacti_dialog_update_activity(a){if(!bookacti.selected_template||!a){return false}$j("#bookacti-activity-data-dialog").dialog({title:bookacti_localized.dialog_update_activity_title});$j("#bookacti-activity-template-id").val(bookacti.selected_template);$j("#bookacti-activity-activity-id").val(a);$j("#bookacti-activity-action").val("bookactiUpdateActivity");$j("#bookacti-activity-old-title").val($j('.fc-event[data-activity-id="'+a+'"]').data("title"));$j("#bookacti-activity-data-dialog .bookacti-add-new-items-select-box option").show().attr("disabled",false);bookacti_start_template_loading();$j.ajax({url:ajaxurl,data:{action:"bookactiGetActivityData",activity_id:a,nonce:bookacti_localized.nonce_get_activity_data},type:"POST",dataType:"json",success:function(b){if(b.status==="success"){$j("#bookacti-activity-title").val(b.activity.title);$j("#bookacti-activity-color").val(b.activity.color);$j("#bookacti-activity-availability").val(b.activity.availability);$j("#bookacti-activity-duration-days").val(b.activity.duration.substr(0,3));$j("#bookacti-activity-duration-hours").val(b.activity.duration.substr(4,2));$j("#bookacti-activity-duration-minutes").val(b.activity.duration.substr(7,2));if(b.activity.is_resizable==1){$j("#bookacti-activity-resizable").prop("checked",true)}else{$j("#bookacti-activity-resizable").prop("checked",false)}if(b.activity.admin){$j.each(b.activity.admin,function(d,e){$j('#bookacti-add-new-activity-managers-select-box option[value="'+e+'"]').clone().appendTo("#bookacti-activity-managers-select-box");$j('#bookacti-add-new-activity-managers-select-box option[value="'+e+'"]').hide().attr("disabled",true);if($j("#bookacti-add-new-activity-managers-select-box").val()==e||!$j("#bookacti-add-new-activity-managers-select-box").val()){$j("#bookacti-add-new-activity-managers-select-box").val($j("#bookacti-add-new-activity-managers-select-box option:enabled:first").val())}})}if(b.activity.templates){$j.each(b.activity.templates,function(e,d){$j('#bookacti-add-new-activity-templates-select-box option[value="'+d+'"]').clone().appendTo("#bookacti-activity-templates-select-box");$j('#bookacti-add-new-activity-templates-select-box option[value="'+d+'"]').hide().attr("disabled",true);if($j("#bookacti-add-new-activity-templates-select-box").val()==d||!$j("#bookacti-add-new-activity-templates-select-box").val()){$j("#bookacti-add-new-activity-templates-select-box").val($j("#bookacti-add-new-activity-templates-select-box option:enabled:first").val())}})}if(b.activity.settings){bookacti_fill_settings_fields(b.activity.settings,"activityOptions")}if(bookacti_localized.is_qtranslate){$j("#bookacti-activity-data-dialog .qtranxs-translatable").each(function(){bookacti_refresh_qtx_field(this)})}}else{var c=bookacti_localized.error_retrieve_activity_data;if(b.error==="not_allowed"){c+="\n"+bookacti_localized.error_not_allowed}alert(c);console.log(b)}},error:function(b){alert("AJAX "+bookacti_localized.error_retrieve_activity_data);console.log(b)},complete:function(){bookacti_stop_template_loading();$j("#bookacti-activity-data-dialog").dialog("open")}});$j("#bookacti-activity-data-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){$j("#bookacti-activity-data-form select[multiple] option").attr("selected",true);var i=$j("#bookacti-activity-title").val();var g=$j("#bookacti-activity-color").val();var d=$j("#bookacti-activity-availability").val();var k=$j("#bookacti-activity-duration-days").val();var j=$j("#bookacti-activity-duration-hours").val();var f=$j("#bookacti-activity-duration-minutes").val();var e=bookacti_pad(k,3)+"."+bookacti_pad(j,2)+":"+bookacti_pad(f,2)+":00";var b=$j("#bookacti-activity-resizable").prop("checked");if(b){b="1"}else{b="0"}b=b.toString();$j("#bookacti-activity-duration").val(e);var h=$j("#bookacti-activity-data-form").serialize();var c=bookacti_validate_activity_form();if(c){bookacti_start_template_loading();$j.ajax({url:ajaxurl,data:h,type:"POST",dataType:"json",success:function(l){if(l.status==="success"){bookacti.booking_system["bookacti-template-calendar"]["activities_data"][a]=l.activity_data;$j('.fc-event[data-activity-id="'+a+'"]').html(l.title);$j('.fc-event[data-activity-id="'+a+'"]').data("title",l.multilingual_title);$j('.fc-event[data-activity-id="'+a+'"]').data("color",g);$j('.fc-event[data-activity-id="'+a+'"]').data("availability",d);$j('.fc-event[data-activity-id="'+a+'"]').data("duration",e);$j('.fc-event[data-activity-id="'+a+'"]').data("resizable",b);$j('.fc-event[data-activity-id="'+a+'"]').attr("data-title",l.multilingual_title);$j('.fc-event[data-activity-id="'+a+'"]').attr("data-color",g);$j('.fc-event[data-activity-id="'+a+'"]').attr("data-availability",d);$j('.fc-event[data-activity-id="'+a+'"]').attr("data-duration",e);$j('.fc-event[data-activity-id="'+a+'"]').attr("data-resizable",b);bookacti_init_activities();bookacti_refetch_events_on_template()}else{if(l.status==="no_templates"){alert(bookacti_localized.error_no_templates_for_activity);console.log(l)}else{if(l.status==="failed_update_activity"){alert(bookacti_localized.error_update_activity);console.log(l)}else{if(l.status==="failed_update_bound_events"){alert(bookacti_localized.error_update_bound_events);console.log(l)}else{if(l.status==="no_changes"){}else{if(l.status==="failed"){var m=bookacti_localized.error_update_activity;if(l.error==="not_allowed"){m+="\n"+bookacti_localized.error_not_allowed}alert(m);console.log(l)}}}}}}},error:function(l){alert("AJAX "+bookacti_localized.error_update_activity);console.log(l)},complete:function(){bookacti_stop_template_loading()}});$j(this).dialog("close")}}},{text:bookacti_localized.dialog_button_delete,"class":"bookacti-dialog-delete-button bookacti-dialog-left-button",click:function(){bookacti_dialog_delete_activity(a)}}])}function bookacti_dialog_delete_activity(a){if(a){$j("#bookacti-delete-activity-events").prop("checked",false);$j("#bookacti-delete-activity-dialog").dialog("open");$j("#bookacti-delete-activity-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_delete,"class":"bookacti-dialog-delete-button",click:function(){var b=$j("#bookacti-delete-activity-events").is(":checked")?1:0;bookacti_start_template_loading();$j.ajax({url:ajaxurl,data:{action:"bookactiDeactivateActivity",activity_id:a,template_id:bookacti.selected_template,delete_events:b,nonce:bookacti_localized.nonce_deactivate_activity},type:"POST",dataType:"json",success:function(c){if(c.status==="success"){delete bookacti.booking_system["bookacti-template-calendar"]["activities_data"][a];$j('.fc-event[data-activity-id="'+a+'"]').parents(".activity-row").remove();if(b){bookacti_refetch_events_on_template()}bookacti_display_activity_tuto_if_no_activity_available();bookacti_update_shortcode_generator_activity_ids(a,false,false)}else{var d=bookacti_localized.error_delete_activity;if(c.error==="not_allowed"){d+="\n"+bookacti_localized.error_not_allowed}alert(d);console.log(c)}},error:function(c){alert("AJAX "+bookacti_localized.error_delete_activity);console.log(c)},complete:function(){bookacti_stop_template_loading()}});$j(this).dialog("close");$j("#bookacti-activity-data-dialog").dialog("close");$j("#bookacti-activity-create-method-dialog").dialog("close")}},{text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}}])}}function bookacti_dialog_create_group_of_events(a){a=a?a:bookacti.selected_category;$j("#bookacti-group-of-events-dialog").dialog({title:bookacti_localized.dialog_create_group_of_events_title});if($j("#bookacti-group-of-events-category-selectbox option").length>1){a=$j('#bookacti-group-of-events-category-selectbox option[value="'+a+'"]').length?a:"new";$j("#bookacti-group-of-events-category-selectbox").val(a).trigger("change")}else{$j("#bookacti-group-of-events-new-category-title").show()}$j("#bookacti-group-of-events-summary").empty();bookacti.booking_system["bookacti-template-calendar"]["selected_events"]=bookacti_sort_events_array_by_dates(bookacti.booking_system["bookacti-template-calendar"]["selected_events"]);$j.each(bookacti.booking_system["bookacti-template-calendar"]["selected_events"],function(d,g){var f=moment(g.start);var c=moment(g.end);var b=f.format(bookacti_localized.date_format)+" &rarr; "+c.format(bookacti_localized.date_format);if(g.start.substr(0,10)===g.end.substr(0,10)){b=f.format(bookacti_localized.date_format)+" &rarr; "+c.format("LT")}var e=$j("<option />",{html:g.title+" - "+b});e.appendTo("#bookacti-group-of-events-summary")});$j("#bookacti-group-of-events-dialog").dialog("open");$j("#bookacti-group-of-events-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){$j("#bookacti-group-of-events-action").val("bookactiInsertGroupOfEvents");$j("#bookacti-group-of-events-form select[multiple] option").attr("selected",true);var b=$j("#bookacti-group-of-events-category-selectbox").val();bookacti.selected_category=b;var c=$j("#bookacti-group-of-events-form").serializeArray();c.push({name:"template_id",value:bookacti.selected_template});c.push({name:"events",value:JSON.stringify(bookacti.booking_system["bookacti-template-calendar"]["selected_events"])});var d=bookacti_validate_group_of_events_form();if(d){bookacti_start_template_loading();$j.ajax({url:ajaxurl,data:c,type:"POST",dataType:"json",success:function(e){if(e.status==="success"){bookacti.booking_system["bookacti-template-calendar"]["groups_events"][e.group_id]=e.group_events;bookacti.booking_system["bookacti-template-calendar"]["groups_data"][e.group_id]=e.group;bookacti.booking_system["bookacti-template-calendar"]["group_categories_data"][e.category_id]=e.category;bookacti.booking_system["bookacti-template-calendar"]["selected_events"]=[];$j("#bookacti-template-add-first-group-of-events-container").hide();if(b==="new"){bookacti_add_group_category(e.category_id,e.category.title)}bookacti_add_group_of_events(e.group_id,e.group.title,e.category_id);$j("#bookacti-template-calendar").fullCalendar("rerenderEvents");$j("#bookacti-insert-group-of-events").css("visibility","hidden");bookacti_exit_group_edition()}else{var f=bookacti_localized.error_create_group_of_events;if(e.error==="not_allowed"){f+="\n"+bookacti_localized.error_not_allowed}alert(f);console.log(e)}},error:function(f){alert("AJAX "+bookacti_localized.error_create_group_of_events);console.log(f)},complete:function(){bookacti_stop_template_loading()}});$j("#bookacti-group-of-events-dialog").dialog("close")}}}])}function bookacti_update_group_of_events(b){var a=$j('.bookacti-group-of-events[data-group-id="'+b+'"] .bookacti-update-group-of-events img').hasClass("validate-group");if(a){bookacti_dialog_update_group_of_events(b)}else{bookacti_select_events_of_group(b)}}function bookacti_dialog_update_group_of_events(c){$j("#bookacti-group-of-events-dialog").dialog({title:bookacti_localized.dialog_update_group_of_events_title});var b=$j('.bookacti-group-of-events[data-group-id="'+c+'"]').parents(".bookacti-group-category").data("group-category-id");var a=b?b:"new";$j("#bookacti-group-of-events-category-selectbox").val(b).trigger("change");$j("#bookacti-group-of-events-summary").empty();bookacti.booking_system["bookacti-template-calendar"]["selected_events"]=bookacti_sort_events_array_by_dates(bookacti.booking_system["bookacti-template-calendar"]["selected_events"]);$j.each(bookacti.booking_system["bookacti-template-calendar"]["selected_events"],function(f,j){var h=moment(j.start);var e=moment(j.end);var d=h.format(bookacti_localized.date_format)+" &rarr; "+e.format(bookacti_localized.date_format);if(j.start.substr(0,10)===j.end.substr(0,10)){d=h.format(bookacti_localized.date_format)+" &rarr; "+e.format("LT")}var g=$j("<option />",{html:j.title+" - "+d});g.appendTo("#bookacti-group-of-events-summary")});bookacti_start_template_loading();$j.ajax({url:ajaxurl,data:{action:"bookactiGetGroupOfEventsData",group_id:c,nonce:bookacti_localized.nonce_get_group_of_events_data},type:"POST",dataType:"json",success:function(d){if(d.status==="success"){$j("#bookacti-group-of-events-title-field").val(d.multilingual_title);if(d.settings){bookacti_fill_settings_fields(d.settings,"groupOfEventsOptions")}if(bookacti_localized.is_qtranslate){$j("#bookacti-group-of-events-dialog .qtranxs-translatable").each(function(){bookacti_refresh_qtx_field(this)})}}else{var e=bookacti_localized.error_retrieve_group_of_events_data;if(d.error==="not_allowed"){e+="\n"+bookacti_localized.error_not_allowed}alert(e);console.log(d)}},error:function(d){alert("AJAX "+bookacti_localized.error_retrieve_group_of_events_data);console.log(d)},complete:function(){bookacti_stop_template_loading();$j("#bookacti-group-of-events-dialog").dialog("open")}});$j("#bookacti-group-of-events-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){$j("#bookacti-group-of-events-action").val("bookactiUpdateGroupOfEvents");$j("#bookacti-group-of-events-form select[multiple] option").attr("selected",true);var d=$j("#bookacti-group-of-events-category-selectbox").val();bookacti.selected_category=d;var e=$j("#bookacti-group-of-events-form").serializeArray();e.push({name:"group_id",value:c});e.push({name:"events",value:JSON.stringify(bookacti.booking_system["bookacti-template-calendar"]["selected_events"])});var f=bookacti_validate_group_of_events_form();if(f){bookacti_start_template_loading();$j.ajax({url:ajaxurl,data:e,type:"POST",dataType:"json",success:function(h){if(h.status==="success"){bookacti.booking_system["bookacti-template-calendar"]["groups_events"][c]=h.group_events;bookacti.booking_system["bookacti-template-calendar"]["groups_data"][c]=h.group;bookacti.booking_system["bookacti-template-calendar"]["group_categories_data"][h.category_id]=h.category;bookacti.booking_system["bookacti-template-calendar"]["selected_events"]=[];if(d==="new"){bookacti_add_group_category(h.category_id,h.category.title)}if(a!=d){$j('.bookacti-group-of-events[data-group-id="'+c+'"]').remove();bookacti_add_group_of_events(c,h.group.title,h.category_id)}else{var g=h.group.title.length>16?h.group.title.substr(0,16)+"&#8230;":h.group.title;$j('.bookacti-group-of-events[data-group-id="'+c+'"] .bookacti-group-of-events-title').attr("title",h.group.title);$j('.bookacti-group-of-events[data-group-id="'+c+'"] .bookacti-group-of-events-title').html(g)}$j("#bookacti-template-calendar").fullCalendar("rerenderEvents");$j("#bookacti-insert-group-of-events").css("visibility","hidden");bookacti_exit_group_edition()}else{if(h.status==="failed"){var i=bookacti_localized.error_update_group_of_events;if(h.error==="not_allowed"){i+="\n"+bookacti_localized.error_not_allowed}alert(i)}console.log(h)}},error:function(g){alert("AJAX "+bookacti_localized.error_update_group_of_events);console.log(g)},complete:function(){bookacti_stop_template_loading()}});$j("#bookacti-group-of-events-dialog").dialog("close")}}},{text:bookacti_localized.dialog_button_delete,"class":"bookacti-dialog-delete-button bookacti-dialog-left-button",click:function(){bookacti_dialog_delete_group_of_events(c)}}])}function bookacti_dialog_delete_group_of_events(a){$j("#bookacti-delete-group-of-events-dialog").dialog("open");$j("#bookacti-delete-group-of-events-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_delete,"class":"bookacti-dialog-delete-button",click:function(){bookacti_start_template_loading();$j.ajax({url:ajaxurl,data:{action:"bookactiDeleteGroupOfEvents",group_id:a,nonce:bookacti_localized.nonce_delete_group_of_events},type:"POST",dataType:"json",success:function(b){if(b.status==="success"){delete bookacti.booking_system["bookacti-template-calendar"]["groups_data"][a];delete bookacti.booking_system["bookacti-template-calendar"]["groups_events"][a];bookacti.booking_system["bookacti-template-calendar"]["selected_events"]=[];$j('.bookacti-group-of-events[data-group-id="'+a+'"]').remove();$j("#bookacti-template-calendar").fullCalendar("rerenderEvents");$j("#bookacti-insert-group-of-events").css("visibility","hidden")}else{var c=bookacti_localized.error_delete_group_of_events;if(b.error==="not_allowed"){c+="\n"+bookacti_localized.error_not_allowed}alert(c);console.log(b)}},error:function(b){alert("AJAX "+bookacti_localized.error_delete_group_of_events);console.log(b)},complete:function(){bookacti_stop_template_loading()}});$j(this).dialog("close");$j("#bookacti-group-of-events-dialog").dialog("close")}},{text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}}])}function bookacti_dialog_update_group_category(a){bookacti_start_template_loading();$j.ajax({url:ajaxurl,data:{action:"bookactiGetGroupCategoryData",category_id:a,nonce:bookacti_localized.nonce_get_group_category_data},type:"POST",dataType:"json",success:function(b){if(b.status==="success"){$j("#bookacti-group-category-title-field").val(b.multilingual_title);if(b.settings){bookacti_fill_settings_fields(b.settings,"groupCategoryOptions")}if(bookacti_localized.is_qtranslate){$j("#bookacti-group-category-dialog .qtranxs-translatable").each(function(){bookacti_refresh_qtx_field(this)})}}else{var c=bookacti_localized.error_retrieve_group_category_data;if(b.error==="not_allowed"){c+="\n"+bookacti_localized.error_not_allowed}alert(c);console.log(b)}},error:function(b){alert("AJAX "+bookacti_localized.error_retrieve_group_category_data);console.log(b)},complete:function(){bookacti_stop_template_loading();$j("#bookacti-group-category-dialog").dialog("open")}});$j("#bookacti-group-category-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){$j("#bookacti-group-category-action").val("bookactiUpdateGroupCategory");$j("#bookacti-group-category-form select[multiple] option").attr("selected",true);var b=$j("#bookacti-group-category-form").serializeArray();b.push({name:"category_id",value:a});var c=bookacti_validate_group_category_form();if(c){bookacti_start_template_loading();$j.ajax({url:ajaxurl,data:b,type:"POST",dataType:"json",success:function(d){if(d.status==="success"){bookacti.booking_system["bookacti-template-calendar"]["group_categories_data"][a]=d.category;var e=d.category.title.length>16?d.category.title.substr(0,16)+"&#8230;":d.category.title;$j('.bookacti-group-category[data-group-category-id="'+a+'"] .bookacti-group-category-title').attr("title",d.category.title);$j('.bookacti-group-category[data-group-category-id="'+a+'"] .bookacti-group-category-title span').html(e);$j('#bookacti-group-of-events-category-selectbox option[value="'+a+'"]').html(d.category.title)}else{if(d.status==="failed"){var f=bookacti_localized.error_update_group_category;if(d.error==="not_allowed"){f+="\n"+bookacti_localized.error_not_allowed}alert(f);console.log(d)}}},error:function(d){alert("AJAX "+bookacti_localized.error_update_group_category);console.log(d)},complete:function(){bookacti_stop_template_loading()}});$j("#bookacti-group-category-dialog").dialog("close")}}},{text:bookacti_localized.dialog_button_delete,"class":"bookacti-dialog-delete-button bookacti-dialog-left-button",click:function(){bookacti_dialog_delete_group_category(a)}}])}function bookacti_dialog_delete_group_category(a){$j("#bookacti-delete-group-category-dialog").dialog("open");$j("#bookacti-delete-group-category-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_delete,"class":"bookacti-dialog-delete-button",click:function(){bookacti_start_template_loading();$j.ajax({url:ajaxurl,data:{action:"bookactiDeleteGroupCategory",category_id:a,nonce:bookacti_localized.nonce_delete_group_category},type:"POST",dataType:"json",success:function(b){if(b.status==="success"){delete bookacti.booking_system["bookacti-template-calendar"]["group_categories_data"][a];bookacti.booking_system["bookacti-template-calendar"]["selected_events"]=[];var d=[];$j.each(bookacti.booking_system["bookacti-template-calendar"]["groups_data"],function(f,e){if(e.category_id==a){d.push(e.id)}});$j.each(d,function(f,e){delete bookacti.booking_system["bookacti-template-calendar"]["groups_events"][e];delete bookacti.booking_system["bookacti-template-calendar"]["groups_data"][e]});$j('.bookacti-group-category[data-group-category-id="'+a+'"]').remove();$j('#bookacti-group-of-events-category-selectbox option[value="'+a+'"]').remove();$j("#bookacti-template-calendar").fullCalendar("rerenderEvents");$j("#bookacti-insert-group-of-events").css("visibility","hidden");if(!$j(".bookacti-group-category").length){$j("#bookacti-template-add-group-of-events-tuto-select-events").show()}}else{var c=bookacti_localized.error_delete_group_category;if(b.error==="not_allowed"){c+="\n"+bookacti_localized.error_not_allowed}alert(c);console.log(b)}},error:function(b){alert("AJAX "+bookacti_localized.error_delete_group_category);console.log(b)},complete:function(){bookacti_stop_template_loading()}});$j(this).dialog("close");$j("#bookacti-group-category-dialog").dialog("close")}},{text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}}])};