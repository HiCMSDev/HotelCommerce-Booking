$j(document).ready(function(){$j('#bookacti-template-data-dialog input[type="text"]').off().on("keyup",function(){bookacti_validate_template_form()});$j('#bookacti-template-data-dialog input[type="date"]').off().on("change",function(){bookacti_validate_template_form()});$j("#bookacti-template-data-dialog select").off().on("change blur",function(){bookacti_validate_template_form()});$j('#bookacti-activity-data-dialog input[type="text"]').off().on("keyup",function(){bookacti_validate_activity_form()});$j('#bookacti-activity-data-dialog input[type="number"]').off().on("change",function(){bookacti_validate_activity_form()});$j('#bookacti-activity-data-dialog input[type="color"]').off().on("change",function(){bookacti_validate_activity_form()});$j("#bookacti-event-add-exception-button").off().on("click",function(){var a=bookacti_validate_add_exception_form();if(a){var b=moment($j("#bookacti-event-exception-date-picker").val()).format("YYYY-MM-DD");$j("#bookacti-event-exceptions-selectbox").append("<option class='exception' value='"+b+"' >"+b+"</option>")}});$j("#bookacti-event-exceptions-selectbox").off().on("keyup",function(a){if(a.which===46){$j(this).find("option:selected").remove()}});$j("#bookacti-event-delete-exceptions-button").off().on("click",function(){$j("#bookacti-event-exceptions-selectbox option:selected").remove()});$j("#bookacti-event-title, #bookacti-event-availability").off().on("change",function(){bookacti_validate_event_general_data()})});function bookacti_validate_template_form(){var e=$j("#bookacti-template-title").val();var g=moment($j("#bookacti-template-opening").val());var a=moment($j("#bookacti-template-closing").val());var d=$j("#bookacti-template-duplicated-template-id").val();var f=moment("1970-01-01T"+$j("#bookacti-template-data-minTime").val()+":00");var b=$j("#bookacti-template-data-maxTime").val().substr(0,2)==="00"?moment("1970-01-02T"+$j("#bookacti-template-data-maxTime").val()+":00"):moment("1970-01-01T"+$j("#bookacti-template-data-maxTime").val()+":00");var c={isTitle:false,isStart:false,isEnd:false,isStartBeforeEnd:false,isDayStartBeforeEnd:false,isDuplicateIdPositive:false,send:false};if(e!==""){c.isTitle=true}if(!isNaN(g)&&g!==""&&g!==null){c.isStart=true}if(!isNaN(a)&&a!==""&&a!==null){c.isEnd=true}if(c.isStart&&c.isEnd&&(g<a)){c.isStartBeforeEnd=true}if(d!==""&&$j.isNumeric(d)&&parseInt(d)>=0){c.isDuplicateIdPositive=true}if(f.isBefore(b)){c.isDayStartBeforeEnd=true}if(c.isTitle&&c.isDuplicateIdPositive&&c.isStartBeforeEnd&&c.isDayStartBeforeEnd){c.send=true}$j("#bookacti-template-data-dialog .form-error").remove();$j("#bookacti-template-data-dialog input, #bookacti-template-data-dialog select").removeClass("input-error");$j("#bookacti-template-data-dialog").trigger("bookacti_validate_template_form",[c]);if(!c.isTitle){$j("#bookacti-template-title").addClass("input-error");$j("#bookacti-template-title").parent().append("<div class='form-error'>"+bookacti_localized.error_fill_field+"</div>")}if(!c.isStartBeforeEnd&&c.isStart&&c.isEnd){$j("#bookacti-template-closing").addClass("input-error");$j("#bookacti-template-closing").parent().append("<div class='form-error'>"+bookacti_localized.error_template_end_before_begin+"</div>")}if(!c.isStart){$j("#bookacti-template-opening").addClass("input-error");$j("#bookacti-template-opening").parent().append("<div class='form-error'>"+bookacti_localized.error_fill_field+"</div>")}if(!c.isEnd){$j("#bookacti-template-closing").addClass("input-error");$j("#bookacti-template-closing").parent().append("<div class='form-error'>"+bookacti_localized.error_fill_field+"</div>")}if(!c.isDuplicateIdPositive){$j("#bookacti-template-duplicated-template-id").addClass("input-error");$j("#bookacti-template-duplicated-template-id").parent().append("<div class='form-error'>"+bookacti_localized.error_invalid_value+"</div>")}if(!c.isDayStartBeforeEnd){$j("#bookacti-template-data-minTime").addClass("input-error");$j("#bookacti-template-data-maxTime").addClass("input-error");$j("#bookacti-template-data-maxTime").parent().append("<div class='form-error'>"+bookacti_localized.error_day_end_before_begin+"</div>")}return c.send}function bookacti_validate_activity_form(){var g=$j("#bookacti-activity-title").val();var b=$j("#bookacti-activity-color").val();var f=$j("#bookacti-activity-availability").val();var h=$j("#bookacti-activity-duration-days").val();var a=$j("#bookacti-activity-duration-hours").val();var e=$j("#bookacti-activity-duration-minutes").val();var d=$j("#bookacti-activity-templates-select-box option").length;var c={isTitle:false,isColor:false,isColorWhite:false,isAvail:false,isAvailPositive:false,isDays:false,isHours:false,isMinutes:false,isDaysInfTo365:false,isHoursInfTo23:false,isMinutesInfTo59:false,isSupToZero:false,areTemplates:false,send:false};if(g.length>0){c.isTitle=true}if(b.length>0){c.isColor=true}if(c.isColor&&b==="#ffffff"){c.isColorWhite=true}if(f.length>0){c.isAvail=true}if(c.isAvail&&parseInt(f)>=0){c.isAvailPositive=true}if(h.length>0){c.isDays=true}if(a.length>0){c.isHours=true}if(e.length>0){c.isMinutes=true}if(c.isDays&&h<=365&&h>=0){c.isDaysInfTo365=true}if(c.isHours&&a<=23&&a>=0){c.isHoursInfTo23=true}if(c.isMinutes&&e<=59&&e>=0){c.isMinutesInfTo59=true}if(h>0||a>0||e>0){c.isSupToZero=true}if(d>0){c.areTemplates=true}if(c.isTitle&&c.isColor&&c.isAvailPositive&&c.isDaysInfTo365&&c.isHoursInfTo23&&c.isMinutesInfTo59&&c.isSupToZero&&c.areTemplates){c.send=true}$j("#bookacti-activity-data-dialog .form-error").remove();$j("#bookacti-activity-data-dialog *").removeClass("input-error input-warning");$j("#bookacti-activity-data-dialog").trigger("bookacti_validate_activity_form",[c]);if(!c.isTitle){$j("#bookacti-activity-title").addClass("input-error");$j("#bookacti-activity-title").parent().append("<div class='form-error'>"+bookacti_localized.error_fill_field+"</div>")}if(!c.isColor){$j("#bookacti-activity-color").addClass("input-error");$j("#bookacti-activity-color").parent().append("<div class='form-error'>"+bookacti_localized.error_fill_field+"</div>")}if(!c.isAvail){$j("#bookacti-activity-availability").addClass("input-error");$j("#bookacti-activity-availability").parent().append("<div class='form-error'>"+bookacti_localized.error_fill_field+"</div>")}if(c.isAvail&&!c.isAvailPositive){$j("#bookacti-activity-availability").addClass("input-error");$j("#bookacti-activity-availability").parent().append("<div class='form-error'>"+bookacti_localized.error_availability_inf_to_0+"</div>")}if(c.isDays&&!c.isDaysInfTo365){$j("#bookacti-activity-duration-days").addClass("input-error");$j("#bookacti-activity-duration-days").parent().append("<div class='form-error'>"+bookacti_localized.error_days_sup_to_365+"</div>")}if(c.isHours&&!c.isHoursInfTo23){$j("#bookacti-activity-duration-hours").addClass("input-error");$j("#bookacti-activity-duration-hours").parent().append("<div class='form-error'>"+bookacti_localized.error_hours_sup_to_23+"</div>")}if(c.isMinutes&&!c.isMinutesInfTo59){$j("#bookacti-activity-duration-minutes").addClass("input-error");$j("#bookacti-activity-duration-minutes").parent().append("<div class='form-error'>"+bookacti_localized.error_minutes_sup_to_59+"</div>")}if(!c.isSupToZero){$j("#bookacti-activity-duration-days, #bookacti-activity-duration-hours, #bookacti-activity-duration-minutes").addClass("input-error");$j("#bookacti-activity-duration-days").parent().append("<div class='form-error'>"+bookacti_localized.error_activity_duration_is_null+"</div>")}if(!c.areTemplates){$j("#bookacti-activity-templates-select-box").addClass("input-error");$j("#bookacti-activity-templates-select-box").parent().append("<div class='form-error'>"+bookacti_localized.error_no_templates_for_activity+"</div>")}if(c.isColorWhite){$j("#bookacti-activity-color").addClass("input-warning")}if(!c.isDays){$j("#bookacti-activity-duration-days").addClass("input-warning");$j("#bookacti-activity-duration-days").val(0)}if(!c.isHours){$j("#bookacti-activity-duration-hours").addClass("input-warning");$j("#bookacti-activity-duration-hours").val(0)}if(!c.isMinutes){$j("#bookacti-activity-duration-minutes").addClass("input-warning");$j("#bookacti-activity-duration-minutes").val(0)}return c.send}function bookacti_validate_event_form(b){var a={isRepetitionValid:bookacti_validate_event_repetition_data(b),isGeneralValid:bookacti_validate_event_general_data(),send:false};if(a.isRepetitionValid&&a.isGeneralValid){a.send=true}$j("#bookacti-event-data-dialog").trigger("bookacti_validate_event_form",[a]);return a.send}function bookacti_validate_event_general_data(){var d=$j("#bookacti-event-data-dialog #bookacti-event-title").val();var c=parseInt($j("#bookacti-event-data-dialog #bookacti-event-availability").val());var a=parseInt($j("#bookacti-event-data-dialog #bookacti-event-availability").attr("min"))||0;var b={isTitle:false,isAvailPositive:false,isAvailSupToBookings:false,send:false};if(d!==""){b.isTitle=true}if(c>=0){b.isAvailPositive=true}if(c>=a){b.isAvailSupToBookings=true}if(b.isTitle&&b.isAvailPositive&&b.isAvailSupToBookings){b.send=true}$j("#bookacti-tab-content-general .form-error").remove();$j("#bookacti-tab-content-general *").removeClass("input-error input-warning");$j("#bookacti-event-data-dialog").trigger("bookacti_validate_event_general_data",[b]);if(!b.isTitle){$j("#bookacti-event-title").addClass("input-error");$j("#bookacti-event-title").parent().append("<div class='form-error'>"+bookacti_localized.error_fill_field+"</div>")}if(!b.isAvailPositive){$j("#bookacti-event-availability").addClass("input-error");$j("#bookacti-event-availability").parent().append("<div class='form-error'>"+bookacti_localized.error_availability_inf_to_0+"</div>")}if(!b.isAvailSupToBookings){$j("#bookacti-event-availability").addClass("input-error");$j("#bookacti-event-availability").parent().append("<div class='form-error'>"+bookacti_localized.error_less_avail_than_bookings+" ("+a+")</div>")}return b.send}function bookacti_validate_event_repetition_data(b){$j("#bookacti-event-repeat-freq, #bookacti-event-repeat-from, #bookacti-event-repeat-to").off().on("change",function(){bookacti_validate_event_repetition_data(b)});var f=b.start.format("YYYY-MM-DD HH:mm:ss")||bookacti.booking_system["bookacti-template-calendar"]["picked_events"][0]["start"];var j=b.end.format("YYYY-MM-DD HH:mm:ss")||bookacti.booking_system["bookacti-template-calendar"]["picked_events"][0]["end"];var g=parseInt($j("#bookacti-event-data-dialog #bookacti-event-availability").attr("min"));var m=$j("#bookacti-event-data-dialog #bookacti-event-repeat-freq").val()||bookacti.booking_system["bookacti-template-calendar"]["events_data"][b.id]["repeat_freq"]+"";var d=bookacti.booking_system["bookacti-template-calendar"]["events_data"][b.id]["repeat_freq"]+"";var k=moment($j("#bookacti-event-data-dialog #bookacti-event-repeat-from").val());var l=moment($j("#bookacti-event-data-dialog #bookacti-event-repeat-from").attr("max")).format("YYYY-MM-DD");var i=moment($j("#bookacti-event-data-dialog #bookacti-event-repeat-to").val());var e=moment($j("#bookacti-event-data-dialog #bookacti-event-repeat-to").attr("min")).format("YYYY-MM-DD");var c=moment($j("#bookacti-template-picker :selected").data("template-start"));var a=moment($j("#bookacti-template-picker :selected").data("template-end"));var h={isFreqAllowed:false,isRepeated:false,isRepeatFrom:false,isRepeatTo:false,isFromBeforeTo:false,isRepeatFromAfterTemplateStart:false,isRepeatToBeforeTemplateEnd:false,isRepeatFromBeforeFirstBooked:false,isRepeatToAfterLastBooked:false,isEventBetweenFromAndTo:false,areExcep:false,areExcepBetweenFromAndTo:true,send:false};if(m!=="none"){h.isRepeated=true}if(!isNaN(k)&&k!==""&&k!==null){h.isRepeatFrom=true}if(!isNaN(i)&&i!==""&&i!==null){h.isRepeatTo=true}if(h.isRepeatFrom&&h.isRepeatTo&&(k<i)){h.isFromBeforeTo=true}if(h.isRepeated){if((f.substr(0,10)>=k.format("YYYY-MM-DD"))&&(j.substr(0,10)<=i.format("YYYY-MM-DD"))){h.isEventBetweenFromAndTo=true}}if(h.isRepeatFrom){if((k.format("YYYY-MM-DD")>=c.format("YYYY-MM-DD"))){h.isRepeatFromAfterTemplateStart=true}}if(h.isRepeatTo){if((i.format("YYYY-MM-DD")<=a.format("YYYY-MM-DD"))){h.isRepeatToBeforeTemplateEnd=true}}if(h.isRepeatFrom){if((k.format("YYYY-MM-DD")<=l)){h.isRepeatFromBeforeFirstBooked=true}}if(h.isRepeatTo){if((i.format("YYYY-MM-DD")>=e)){h.isRepeatToAfterLastBooked=true}}if($j("#bookacti-event-data-dialog .exception").length>0){h.areExcep=true}if(!h.isRepeated){h.send=true}else{if(h.isRepeatFrom&&h.isRepeatTo&&h.isFromBeforeTo&&h.isRepeatFromBeforeFirstBooked&&h.isRepeatToAfterLastBooked&&h.isEventBetweenFromAndTo){h.send=true}}$j("#bookacti-event-data-dialog #bookacti-event-repeat-freq option").prop("disabled",true);$j("#bookacti-event-data-dialog #bookacti-event-repeat-from").prop("disabled",true);$j("#bookacti-event-data-dialog #bookacti-event-repeat-to").prop("disabled",true);$j("#bookacti-event-data-dialog #bookacti-event-exception-date-picker").prop("disabled",true);$j("#bookacti-event-data-dialog #bookacti-event-add-exception-button").prop("disabled",true);$j("#bookacti-event-data-dialog #bookacti-event-exceptions-selectbox").prop("disabled",true);$j("#bookacti-event-data-dialog #bookacti-event-repeat-period-container").hide();$j("#bookacti-event-data-dialog #bookacti-event-exceptions-container").hide();if(h.isRepeatFrom){$j("#bookacti-event-exception-date-picker").attr("min",k.format("YYYY-MM-DD"))}if(h.isRepeatTo){$j("#bookacti-event-exception-date-picker").attr("max",i.format("YYYY-MM-DD"))}$j("#bookacti-event-data-dialog .exception").removeClass("error-exception out-of-period-exception");$j("#bookacti-event-data-dialog .exception").each(function(){var n=moment($j(this).val());if(h.isFromBeforeTo&&(n<k||n>i)){h.areExcepBetweenFromAndTo=false;$j(this).addClass("error-exception out-of-period-exception")}});if(g===0||d==="none"){$j("#bookacti-event-data-dialog #bookacti-event-repeat-freq option").prop("disabled",false);if(m==="none"||m==="daily"||m==="weekly"||m==="monthly"){h.isFreqAllowed=true}}else{if(d==="monthly"){$j('#bookacti-event-data-dialog #bookacti-event-repeat-freq option[value="monthly"]').prop("disabled",false);$j('#bookacti-event-data-dialog #bookacti-event-repeat-freq option[value="weekly"]').prop("disabled",false);$j('#bookacti-event-data-dialog #bookacti-event-repeat-freq option[value="daily"]').prop("disabled",false);if(m==="daily"||m==="weekly"||m==="monthly"){h.isFreqAllowed=true}}else{if(d==="weekly"){$j('#bookacti-event-data-dialog #bookacti-event-repeat-freq option[value="weekly"]').prop("disabled",false);$j('#bookacti-event-data-dialog #bookacti-event-repeat-freq option[value="daily"]').prop("disabled",false);if(m==="daily"||m==="weekly"){h.isFreqAllowed=true}}else{if(d==="daily"){$j('#bookacti-event-data-dialog #bookacti-event-repeat-freq option[value="daily"]').prop("disabled",false);if(m==="daily"){h.isFreqAllowed=true}}}}}$j("#bookacti-tab-content-repetition .form-error").remove();$j("#bookacti-tab-content-repetition *").removeClass("input-error input-warning");$j("#bookacti-event-data-dialog").trigger("bookacti_validate_event_repetition_data",[h]);if(h.isRepeated){$j("#bookacti-event-data-dialog #bookacti-event-repeat-from").prop("disabled",false);$j("#bookacti-event-data-dialog #bookacti-event-repeat-to").prop("disabled",false);$j("#bookacti-event-data-dialog #bookacti-event-repeat-period-container").show();if(h.isFromBeforeTo&&h.isEventBetweenFromAndTo){$j("#bookacti-event-data-dialog #bookacti-event-exception-date-picker").prop("disabled",false);$j("#bookacti-event-data-dialog #bookacti-event-add-exception-button").prop("disabled",false);$j("#bookacti-event-data-dialog #bookacti-event-exceptions-selectbox").prop("disabled",false);$j("#bookacti-event-data-dialog #bookacti-event-exceptions-container").show()}else{$j("#bookacti-event-repeat-from, #bookacti-event-repeat-to").addClass("input-error");if(!h.isFromBeforeTo){$j("#bookacti-event-repeat-period-container").append("<div class='form-error'>"+bookacti_localized.error_repeat_end_before_begin+"</div>")}else{if(!h.isEventBetweenFromAndTo){$j("#bookacti-event-repeat-period-container").append("<div class='form-error'>"+bookacti_localized.error_event_not_btw_from_and_to+"</div>")}}}}if(h.areExcep&&!h.areExcepBetweenFromAndTo){$j("#bookacti-event-exceptions-selectbox").addClass("input-warning");$j("#bookacti-event-add-exception-container").append("<div class='form-error'>"+bookacti_localized.error_excep_not_btw_from_and_to+"</div>")}if(!h.isFreqAllowed){$j("#bookacti-event-repeat-freq").addClass("input-error");$j("#bookacti-event-repeat-freq").parent().append("<div class='form-error'>"+bookacti_localized.error_freq_not_allowed+"</div>")}if(h.isRepeated&&h.isRepeatFrom&&!h.isRepeatFromAfterTemplateStart){$j("#bookacti-event-repeat-from").addClass("input-warning");$j("#bookacti-event-repeat-from").parent().append("<div class='form-error'>"+bookacti_localized.error_repeat_start_before_template+"</div>")}if(h.isRepeated&&h.isRepeatTo&&!h.isRepeatToBeforeTemplateEnd){$j("#bookacti-event-repeat-to").addClass("input-warning");$j("#bookacti-event-repeat-to").parent().append("<div class='form-error'>"+bookacti_localized.error_repeat_end_after_template+"</div>")}if(h.isRepeated&&h.isRepeatFrom&&!h.isRepeatFromBeforeFirstBooked){$j("#bookacti-event-repeat-from").addClass("input-error")}if(h.isRepeated&&h.isRepeatTo&&!h.isRepeatToAfterLastBooked){$j("#bookacti-event-repeat-to").addClass("input-error")}if(!h.isRepeatFromBeforeFirstBooked||!h.isRepeatToAfterLastBooked){$j("#bookacti-event-repeat-to").parent().append("<div class='form-error'>"+bookacti_localized.error_booked_events_out_of_period+" ("+l+" - "+e+")</div>")}return h.send}function bookacti_validate_add_exception_form(){var h=$j("#bookacti-event-data-dialog").data("event-id");var a=moment($j("#bookacti-event-data-dialog #bookacti-event-exception-date-picker").val());var g=moment($j("#bookacti-event-data-dialog #bookacti-event-repeat-from").val());var f=moment($j("#bookacti-event-data-dialog #bookacti-event-repeat-to").val());var b=false;var i=false;var d=true;var c=false;var e=false;if(!isNaN(a)&&a!==""&&a!==null){b=true}if(b&&(a>=g)&&(a<=f)){i=true}$j("#bookacti-event-data-dialog .exception").each(function(){if(a.format("YYYY-MM-DD")===moment($j(this).val()).format("YYYY-MM-DD")){d=false;$j(this).effect("highlight","swing",{color:"#ffff99"},2000)}});var j=$j('.fc-event[data-event-id="'+h+'"][data-event-start^="'+a.format("YYYY-MM-DD")+'"]');if(j.length){if(parseInt(j.find(".bookacti-bookings").text())>0){c=true}}if(i&&d){e=true}$j("#bookacti-event-add-exception-container .form-error, #bookacti-event-add-exception-container .form-warning").remove();$j("#bookacti-event-add-exception-container input").removeClass("input-error input-warning");if(!i){$j("#bookacti-event-exception-date-picker").addClass("input-error");$j("#bookacti-event-add-exception-container").append("<div class='form-error'>"+bookacti_localized.error_excep_not_btw_from_and_to+"</div>")}if(!d){$j("#bookacti-event-exception-date-picker").addClass("input-error");$j("#bookacti-event-add-exception-container").append("<div class='form-error'>"+bookacti_localized.error_excep_duplicated+"</div>")}if(c){$j("#bookacti-event-exception-date-picker").addClass("input-warning");$j("#bookacti-event-add-exception-container").append("<div class='form-warning'>"+bookacti_localized.error_set_excep_on_booked_occur+"</div>")}return e}function bookacti_validate_group_of_events_form(){var d=$j("#bookacti-group-of-events-title-field").val();var b=$j("#bookacti-group-of-events-category-selectbox").val();var c=$j("#bookacti-group-of-events-category-title-field").val();var a={isTitle:false,isCategory:false,isCategoryTitle:false,isSelectedEvents:false,send:false};if(typeof d==="string"&&d!==""){a.isTitle=true}if(typeof b==="string"&&b!=="new"){a.isCategory=true}if(typeof c==="string"&&c!==""){a.isCategoryTitle=true}if(bookacti.booking_system["bookacti-template-calendar"]["selected_events"].length>=2){a.isSelectedEvents=true}if(a.isTitle&&(a.isCategory||a.isCategoryTitle)&&a.isSelectedEvents){a.send=true}$j("#bookacti-group-of-events-dialog .form-error").remove();$j("#bookacti-group-of-events-dialog input, #bookacti-group-of-events-dialog select").removeClass("input-error");$j("#bookacti-group-of-events-dialog").trigger("bookacti_validate_group_of_events_form",[a]);if(!a.isTitle){$j("#bookacti-group-of-events-title-field").addClass("input-error");$j("#bookacti-group-of-events-title-field").parent().append("<div class='form-error'>"+bookacti_localized.error_fill_field+"</div>")}if(!a.isCategory&&!a.isCategoryTitle){$j("#bookacti-group-of-events-category-title-field").addClass("input-error");$j("#bookacti-group-of-events-category-title-field").parent().append("<div class='form-error'>"+bookacti_localized.error_fill_field+"</div>")}if(!a.isSelectedEvents){$j("#bookacti-group-of-events-summary").addClass("input-error");$j("#bookacti-group-of-events-summary").parent().append("<div class='form-error'>"+bookacti_localized.error_select_at_least_two_events+"</div>")}return a.send}function bookacti_validate_group_category_form(){var b=$j("#bookacti-group-category-title-field").val();var a={isTitle:false,send:false};if(typeof b==="string"&&b!==""){a.isTitle=true}if(a.isTitle){a.send=true}$j("#bookacti-group-category-dialog .form-error").remove();$j("#bookacti-group-category-dialog input, #bookacti-template-data-dialog select").removeClass("input-error");$j("#bookacti-group-category-dialog").trigger("bookacti_validate_group_category_form",[a]);if(!a.isTitle){$j("#bookacti-group-category-title-field").addClass("input-error");$j("#bookacti-group-category-title-field").parent().append("<div class='form-error'>"+bookacti_localized.error_fill_field+"</div>")}return a.send};