function bookacti_switch_template(a){if(a){bookacti.load_events=false;bookacti_start_template_loading();$j.ajax({url:ajaxurl,data:{action:"bookactiSwitchTemplate",template_id:a,nonce:bookacti_localized.nonce_switch_template},type:"POST",dataType:"json",success:function(f){if(f.status==="success"){var g=bookacti.selected_template?false:true;bookacti.selected_template=parseInt(a);bookacti.hidden_activities=[];bookacti.booking_system["bookacti-template-calendar"]["calendars"]=[bookacti.selected_template];bookacti.booking_system["bookacti-template-calendar"]["bookings"]=f.bookings;bookacti.booking_system["bookacti-template-calendar"]["exceptions"]=f.exceptions;bookacti.booking_system["bookacti-template-calendar"]["activities_data"]=f.activities_data;bookacti.booking_system["bookacti-template-calendar"]["groups_events"]=f.groups_events;bookacti.booking_system["bookacti-template-calendar"]["groups_data"]=f.groups_data;bookacti.booking_system["bookacti-template-calendar"]["group_categories_data"]=f.group_categories_data;bookacti.booking_system["bookacti-template-calendar"]["template_data"]=f.template_data;if(g){bookacti_bind_template_dialogs();bookacti_init_groups_of_events()}$j("#bookacti-template-activity-list .activity-row").remove();$j("#bookacti-template-activity-list").append(f.activities_list);bookacti_init_activities();$j("#bookacti-group-categories").empty();$j("#bookacti-group-categories").append(f.groups_list);if(f.groups_list===""){$j("#bookacti-template-add-group-of-events-tuto-select-events").show()}else{$j("#bookacti-template-add-group-of-events-tuto-select-events").hide()}bookacti.booking_system["bookacti-template-calendar"]["selected_events"]=[];$j("#bookacti-insert-group-of-events").css("visibility","hidden");$j("#bookacti-template-add-first-group-of-events-container").hide();$j('#bookacti-group-of-events-category-selectbox option[value!="new"]').remove();var e=[];$j("#bookacti-group-categories .bookacti-group-category").each(function(){$j("#bookacti-group-of-events-category-selectbox").append('<option value="'+$j(this).data("group-category-id")+'">'+$j(this).find(".bookacti-group-category-title").attr("title")+"</option>");if($j(this).data("visible")==1){e.push($j(this).data("group-category-id"))}});bookacti_update_shortcode_generator_template_id(bookacti.selected_template);var h=[];$j("#bookacti-template-activity-list .activity-row .activity-show-hide img").each(function(){if($j(this).data("activity-visible")==1){h.push($j(this).data("activity-id"))}});bookacti_update_shortcode_generator_activity_ids(h,true,true);bookacti_update_shortcode_generator_group_category_ids(e,true,true);bookacti_update_calendar_settings($j("#bookacti-template-calendar"));$j("#bookacti-template-calendar").fullCalendar("gotoDate",moment());bookacti_booking_method_clear_events($j("#bookacti-template-calendar"));var c=$j("#bookacti-template-calendar").fullCalendar("getView");var d={start:moment.utc(c.intervalStart),end:moment.utc(c.intervalEnd).subtract(1,"days")};bookacti_fetch_events_from_interval($j("#bookacti-template-calendar"),d);bookacti.load_events=true}else{if(f.status==="failed"){var b=bookacti_localized.error_switch_template;if(f.error==="not_allowed"){b+="\n"+bookacti_localized.error_not_allowed}alert(b);console.log(f)}}},error:function(b){console.log("AJAX "+bookacti_localized.error_switch_template);console.log(b)},complete:function(){bookacti_stop_template_loading()}})}else{$j("#bookacti-template-picker").val("");bookacti.selected_template=0;$j("#bookacti-template-calendar").after($j("<div id='bookacti-first-template-container'><h2>"+bookacti_localized.create_first_calendar+"</h2><div id='bookacti-add-first-template-button' ><img src='"+bookacti_localized.plugin_path+"/img/add.png' /></div></div>"));$j("#bookacti-template-sidebar, #bookacti-shortcode-generator-container").addClass("bookacti-no-template");$j("#bookacti-template-calendar").remove();$j(".activity-row").remove();bookacti_display_activity_tuto_if_no_activity_available();bookacti.booking_system["bookacti-template-calendar"]["selected_events"]=[];$j("#bookacti-insert-group-of-events").css("visibility","hidden");$j("#bookacti-template-add-first-group-of-events-container").hide();$j("#bookacti-template-add-group-of-events-tuto-select-events").show();bookacti_bind_template_dialogs()}}function bookacti_init_activities(){$j("#bookacti-template-activities-container .fc-event").each(function(){$j(this).draggable({zIndex:1000,revert:true,revertDuration:100,start:function(a,b){bookacti.is_dragging=true;$j(this).parent().css("overflow","visible")},stop:function(a,b){bookacti.is_dragging=false;$j(this).parent().css("overflow","")}})});if(bookacti.blocked_events===true){$j("#bookacti-template-activities-container img").addClass("bookacti-disabled-img");$j("#bookacti-template-activities-container .fc-event").addClass("bookacti-event-unavailable")}bookacti_display_activity_tuto_if_no_activity_available()}function bookacti_init_show_hide_activities_switch(){var a=bookacti_localized.plugin_path+"/img/";$j("#bookacti-template-activity-list").on("click",".activity-show-hide img",function(){var d=$j(this).data("activity-id");var b=$j.inArray(d,bookacti.hidden_activities);if($j(this).data("activity-visible")===1){$j(this).attr("src",a+"hide.png");$j(this).data("activity-visible",0);$j(this).attr("data-activity-visible",0);if(b===-1){bookacti.hidden_activities.push(d)}}else{$j(this).attr("src",a+"show.png");$j(this).data("activity-visible",1);$j(this).attr("data-activity-visible",1);if(b!==-1){bookacti.hidden_activities.splice(b,1)}}$j("#bookacti-template-calendar").fullCalendar("rerenderEvents");var c=$j(this).data("activity-visible");bookacti_update_shortcode_generator_activity_ids(d,c,false)})}function bookacti_init_groups_of_events(){if($j("#bookacti-template-calendar").length){$j("#bookacti-template-calendar").on("click",".fc-more",function(){bookacti_refresh_selected_events_display()});$j("#bookacti-template-calendar").on("bookacti_select_event bookacti_unselect_event bookacti_unselect_all_events",function(){bookacti_maybe_display_add_group_of_events_button()});$j("#bookacti-template-calendar").on("bookacti_select_event bookacti_unselect_event",function(){if(bookacti.booking_system["bookacti-template-calendar"]["selected_events"].length<=0){bookacti_unselect_all_events()}})}$j("#bookacti-group-categories").on("click",".bookacti-group-category-title",function(){var a=$j(this).parent().data("group-category-id");bookacti_expand_collapse_groups_of_events(a)});$j("#bookacti-group-categories").on("click",".bookacti-group-of-events-title",function(){var b=$j(this).parents(".bookacti-group-of-events").hasClass("bookacti-selected-group");if(!b){var a=$j(this).parents(".bookacti-group-of-events").data("group-id");bookacti_select_events_of_group(a)}else{bookacti_unselect_all_events()}})}function bookacti_add_group_category(d,c){var b=bookacti_localized.plugin_path;var a=c.length>16?c.substr(0,16)+"&#8230;":c;$j("#bookacti-group-categories").append("<div class='bookacti-group-category'  data-group-category-id='"+d+"' data-show-groups='0' data-visible='1' ><div class='bookacti-group-category-show-hide' ><img src='"+b+"/img/show.png' /></div><div class='bookacti-group-category-title' title='"+c+"' ><span>"+a+"</span></div><div class='bookacti-update-group-category' ><img src='"+b+"/img/gear.png' /></div><div class='bookacti-groups-of-events-list'></div></div>");$j("#bookacti-group-of-events-category-selectbox").append("<option value='"+d+"' >"+c+"</option>");bookacti_update_shortcode_generator_group_category_ids(d,true,false);bookacti.selected_category=d}function bookacti_add_group_of_events(d,c,b){if(!$j('.bookacti-group-category[data-group-category-id="'+b+'"]').length){bookacti_add_group_category(b,"Untitled")}var a=c.length>16?c.substr(0,16)+"&#8230;":c;$j('.bookacti-group-category[data-group-category-id="'+b+'"] .bookacti-groups-of-events-list').append("<div class='bookacti-group-of-events' data-group-id='"+d+"' ><div class='bookacti-group-of-events-title' title='"+c+"'>"+a+"</div><div class='bookacti-update-group-of-events' ><img src='"+bookacti_localized.plugin_path+"/img/gear.png' /></div></div>");bookacti_expand_collapse_groups_of_events(b,"expand",true)}function bookacti_init_show_hide_groups_switch(){var a=bookacti_localized.plugin_path+"/img/";$j("#bookacti-group-categories").on("click",".bookacti-group-category-show-hide img",function(){var d=$j(this).parents(".bookacti-group-category");var c=d.data("group-category-id");if(d.data("visible")===1){$j(this).attr("src",a+"hide.png");d.data("visible",0);d.attr("data-visible",0)}else{$j(this).attr("src",a+"show.png");d.data("visible",1);d.attr("data-visible",1)}var b=d.data("visible");bookacti_update_shortcode_generator_group_category_ids(c,b,false)})}function bookacti_select_events_of_group(a){if(!a){return false}bookacti_unselect_all_events();bookacti.booking_system["bookacti-template-calendar"]["selected_events"]=[];$j("#bookacti-template-calendar").fullCalendar("rerenderEvents");if(typeof bookacti.booking_system["bookacti-template-calendar"]["groups_events"][a]!=="undefined"){$j("#bookacti-template-calendar").fullCalendar("gotoDate",bookacti.booking_system["bookacti-template-calendar"]["groups_events"][a][0]["start"])}var b=true;$j.each(bookacti.booking_system["bookacti-template-calendar"]["groups_events"][a],function(c,d){var e=bookacti_select_event(d);if(e===false){b=false}});if(b){$j('.bookacti-group-of-events[data-group-id="'+a+'"]').addClass("bookacti-selected-group")}return b}function bookacti_select_event(b){if((typeof b!=="object")||(typeof b==="object"&&(typeof b.id==="undefined"||typeof b.start==="undefined"))||(typeof bookacti.booking_system["bookacti-template-calendar"]["events_data"][b.id]==="undefined")){return false}var a=bookacti.booking_system["bookacti-template-calendar"]["events_data"][b.id]["activity_id"];b={id:b.id,title:b.title?b.title:$j('.activity-row .fc-event[data-activity-id="'+a+'"]').text(),start:moment(b.start),end:moment(b.end)};var c=$j('.fc-event[data-event-id="'+b.id+'"][data-event-start="'+b.start.format("YYYY-MM-DD HH:mm:ss")+'"]');c.addClass("bookacti-selected-event");c.find(".bookacti-event-action-select-checkbox").prop("checked",true);c.find(".bookacti-event-actions").show();c.find(".bookacti-event-action-select").show();bookacti.booking_system["bookacti-template-calendar"]["selected_events"].push({id:b.id,title:b.title,start:b.start.format("YYYY-MM-DD HH:mm:ss"),end:b.end.format("YYYY-MM-DD HH:mm:ss")});$j("#bookacti-template-calendar").trigger("bookacti_select_event",[b]);return true}function bookacti_unselect_event(c,f,a){a=a?true:false;if((typeof c!=="object"&&!$j.isNumeric(c))||(typeof c==="object"&&(typeof c.id==="undefined"||typeof c.start==="undefined"))||($j.isNumeric(c)&&!a&&typeof f==="undefined")){return false}if(typeof c!=="object"){var e=c;f=f instanceof moment?f:moment(f).isValid()?moment(f):false;c={id:e,start:f}}var d=$j('.fc-event[data-event-id="'+c.id+'"]');if(!a&&c.start){d=$j('.fc-event[data-event-id="'+c.id+'"][data-event-start="'+c.start.format("YYYY-MM-DD HH:mm:ss")+'"]')}d.removeClass("bookacti-selected-event");d.find(".bookacti-event-action-select-checkbox").prop("checked",false);d.find(".bookacti-event-action-select").hide();var b=$j.grep(bookacti.booking_system["bookacti-template-calendar"]["selected_events"],function(g){if(g.id==c.id&&(a||g.start.substr(0,10)===c.start.format("YYYY-MM-DD"))){return false}return true});bookacti.booking_system["bookacti-template-calendar"]["selected_events"]=b;$j("#bookacti-template-calendar").trigger("bookacti_unselect_event",[c,a])}function bookacti_unselect_all_events(){$j(".fc-event").removeClass("bookacti-selected-event");$j(".fc-event").find(".bookacti-event-action-select-checkbox").prop("checked",false);$j(".fc-event").find(".bookacti-event-action-select").hide();bookacti.booking_system["bookacti-template-calendar"]["selected_events"]=[];$j(".bookacti-group-of-events.bookacti-selected-group").removeClass("bookacti-selected-group");$j("#bookacti-template-calendar").trigger("bookacti_unselect_all_events")}function bookacti_refresh_selected_events_display(){$j(".fc-event").removeClass("bookacti-selected-event");$j(".fc-event .bookacti-event-action-select-checkbox").prop("checked",false);$j.each(bookacti.booking_system["bookacti-template-calendar"]["selected_events"],function(b,c){var a=$j('.fc-event[data-event-id="'+c.id+'"][data-event-start="'+c.start+'"]');a.addClass("bookacti-selected-event");a.find(".bookacti-event-action-select-checkbox").prop("checked",true);a.find(".bookacti-event-actions").show();a.find('.bookacti-event-action[data-hide-on-mouseout="1"]').hide();a.find(".bookacti-event-action-select").show()});$j("#bookacti-template-calendar").trigger("bookacti_refresh_selected_events")}function bookacti_update_shortcode_generator_template_id(a){$j(".bookacti-shortcode-calendar-ids").each(function(){$j(this).text(a)});bookacti_refresh_shortcode()}function bookacti_update_shortcode_generator_activity_ids(b,a,c){b=$j.isNumeric(b)?[b]:b;a=a?true:false;c=c?true:false;$j(".bookacti-shortcode-activity-ids").each(function(){var d=[];if(c!==true&&!$j(this).is(":empty")){d=$j(this).text().split(",")}$j.each(b,function(f,g){var e=$j.inArray(g.toString(),d);if(a===true&&e===-1){d.push(g)}else{if(e!==-1){d.splice(e,1)}}});$j(this).text(d.join())});bookacti_refresh_shortcode()}function bookacti_update_shortcode_generator_group_category_ids(b,a,c){b=$j.isNumeric(b)?[b]:b;a=a?true:false;c=c?true:false;$j(".bookacti-shortcode-group-category-ids").each(function(){var d=[];if(c!==true&&!$j(this).is(":empty")){d=$j(this).text().split(",")}$j.each(b,function(f,g){var e=$j.inArray(g.toString(),d);if(a===true&&e===-1){d.push(g)}else{if(e!==-1){d.splice(e,1)}}});$j(this).text(d.join())});bookacti_refresh_shortcode()}function bookacti_refresh_shortcode(){$j(".bookacti-shortcode").each(function(){var b=$j(this).attr("id");var a=$j("#"+b+"-constructor");if(a.length){$j(this).html(a.text())}})}function bookacti_fetch_events_on_template(c,b){c=c||null;b=b||bookacti.booking_system["bookacti-template-calendar"]["events_interval"];if($j.isEmptyObject(b)){var a=$j("#bookacti-template-calendar").fullCalendar("getView");b=bookacti_get_new_interval_of_events($j("#bookacti-template-calendar"),a)}bookacti.booking_system["bookacti-template-calendar"]["events_interval"]=bookacti_get_extended_events_interval($j("#bookacti-template-calendar"),b);bookacti_start_template_loading();$j.ajax({url:ajaxurl,type:"POST",data:{action:"bookactiFetchTemplateEvents",template_id:bookacti.selected_template,event_id:c,interval:b,nonce:bookacti_localized.nonce_fetch_template_events},dataType:"json",success:function(d){if(d.status==="success"){if($j.isEmptyObject(bookacti.booking_system["bookacti-template-calendar"]["events_data"])){bookacti.booking_system["bookacti-template-calendar"]["events_data"]=d.events_data}else{$j.extend(bookacti.booking_system["bookacti-template-calendar"]["events_data"],d.events_data)}$j("#bookacti-template-calendar").fullCalendar("addEventSource",d.events)}else{if(d.error==="not_allowed"){alert(bookacti_localized.error_display_event+"\n"+bookacti_localized.error_not_allowed);console.log(d)}}},error:function(d){alert("AJAX "+bookacti_localized.error_display_event);console.log(d)},complete:function(){bookacti_stop_template_loading()}})}function bookacti_refetch_events_on_template(b){b=b||null;var c=b!=null?b.id:null;bookacti_booking_method_clear_events($j("#bookacti-template-calendar"),b);var d=$j("#bookacti-template-calendar").fullCalendar("getView");var a=bookacti_get_new_interval_of_events($j("#bookacti-template-calendar"),d);bookacti_fetch_events_on_template(c,a)}function bookacti_delete_event(a){bookacti_unselect_event(a);$j.each(bookacti.booking_system["bookacti-template-calendar"]["groups_events"],function(c,d){var b=$j.grep(d,function(e){if(e&&e.id==a.id){return false}return true});bookacti.booking_system["bookacti-template-calendar"]["groups_events"][c]=b});if(a._id!==undefined){if(a._id.indexOf("_")>=0){$j("#bookacti-template-calendar").fullCalendar("removeEvents",a._id)}}$j("#bookacti-template-calendar").fullCalendar("removeEvents",a.id);$j("#bookacti-template-calendar").fullCalendar("refetchEvents")}function bookacti_bind_template_dialogs(){if(bookacti.selected_template){$j("#bookacti-update-template").off().on("click","img",function(){bookacti_dialog_update_template(bookacti.selected_template)});$j("#bookacti-template-activities-container").off().on("click","#bookacti-insert-activity img, #bookacti-template-add-first-activity-button img",function(){if($j("#bookacti-template-picker option").length>1){bookacti_dialog_choose_activity_creation_type()}else{bookacti_dialog_create_activity()}})}else{$j("#bookacti-update-template").off().on("click","img",function(){alert(bookacti_localized.error_no_template_selected)});$j("#bookacti-template-activities-container").off().on("click","#bookacti-insert-activity img, #bookacti-template-add-first-activity-button img",function(){alert(bookacti_localized.error_no_template_selected)})}}function bookacti_init_add_and_remove_items(){$j(".bookacti-items-container").on("click",".bookacti-add-items",function(d){var c=$j(this).parents(".bookacti-items-container");var b=c.find(".bookacti-add-new-items-select-box").is("[multiple]");var f=c.find(".bookacti-add-new-items-select-box").val();var a=f;if(!b){a=[f]}$j.each(a,function(g,e){c.find('.bookacti-add-new-items-select-box option[value="'+e+'"]').clone().appendTo(c.find(".bookacti-items-select-box"));c.find('.bookacti-add-new-items-select-box option[value="'+e+'"]').hide().attr("disabled",true);c.find(".bookacti-add-new-items-select-box").val(c.find(".bookacti-add-new-items-select-box option:enabled:first").val())})});$j(".bookacti-items-container").on("click",".bookacti-remove-items",function(g){var d=$j(this).parents(".bookacti-items-container");var c=d.data("type");var f="";if(c==="users"){f=bookacti_localized.current_user_id}else{if(c==="templates"){f=bookacti.selected_template}}var b=d.find(".bookacti-items-select-box").is("[multiple]");var h=d.find(".bookacti-items-select-box").val();var a=h;if(!b){a=[h]}$j.each(a,function(j,e){if(e!=f){d.find('.bookacti-items-select-box option[value="'+e+'"]').remove();d.find('.bookacti-add-new-items-select-box option[value="'+e+'"]').show().attr("disabled",false);d.find(".bookacti-add-new-items-select-box").val(e)}})})}function bookacti_empty_all_dialog_forms(){$j(".bookacti-backend-dialog .form-error").remove();$j('.bookacti-backend-dialog input[type="hidden"]:not([name^="nonce"]):not([name="_wp_http_referer"])').val("");$j('.bookacti-backend-dialog input[type="text"]').val("");$j('.bookacti-backend-dialog input[type="number"]').val("");$j(".bookacti-backend-dialog textarea").val("");$j('.bookacti-backend-dialog input[type="color"]').val("#3a87ad");$j('.bookacti-backend-dialog input[type="checkbox"]').attr("checked",false);$j('.bookacti-backend-dialog input[type="radio"]').attr("checked",false);$j(".bookacti-backend-dialog option").prop("selected",false);$j(".bookacti-backend-dialog .exception").remove();$j(".bookacti-backend-dialog select.bookacti-add-new-items-select-box option").show().attr("disabled",false);$j(".bookacti-backend-dialog select.bookacti-items-select-box option").remove()}function bookacti_fill_settings_fields(a,b){$j.each(a,function(c,d){if(a[c]){if($j('input[name="'+b+"["+c+'][]"]').is(":checkbox")||$j('input[name="'+b+"["+c+']"]').is(":checkbox")){if($j.isArray(d)){$j('input[name="'+b+"["+c+'][]"]').attr("checked",false);$j.each(d,function(f,e){$j('input[name="'+b+"["+c+'][]"][value="'+e+'"]').attr("checked",true)})}else{if(d==1){$j('input[name="'+b+"["+c+']"]').attr("checked",true)}else{$j('input[name="'+b+"["+c+']"]').attr("checked",false)}}}else{if($j('input[name="'+b+"["+c+']"]').is(":radio")){$j('input[name="'+b+"["+c+']"][value="'+d+'"]').prop("checked",true)}else{if($j('select[name="'+b+"["+c+']"]').length){$j('select[name="'+b+"["+c+']"] option[value="'+d+'"]').attr("selected",true)}else{if($j('select[name="'+b+"["+c+'][]"]').length){$j.each(d,function(e,f){$j('select[name="'+b+"["+c+'][]"] option[value="'+f+'"]').attr("selected",true)})}else{if($j('input[name="'+b+"["+c+']"]').attr("type")==="time"&&d==="24:00"){d="00:00"}$j('input[name="'+b+"["+c+']"]').val(d);$j('textarea[name="'+b+"["+c+']"]').val(d)}}}}}})}function bookacti_update_exceptions(b,a){b=b||bookacti.selected_template;a=a||null;var c=null;if(a!==null){c=a.id}bookacti_start_template_loading();$j.ajax({url:ajaxurl,type:"POST",data:{action:"bookactiGetExceptions",template_id:b,event_id:c,nonce:bookacti_localized.nonce_get_exceptions},dataType:"json",success:function(e){if(e.status==="success"){if(a===null){bookacti.booking_system["bookacti-template-calendar"]["exceptions"]=e.exceptions}else{bookacti.booking_system["bookacti-template-calendar"]["exceptions"][c]=e.exceptions[c]}}else{if(e.status==="no_exception"){if(a===null){bookacti.booking_system["bookacti-template-calendar"]["exceptions"]=[]}else{bookacti.booking_system["bookacti-template-calendar"]["exceptions"][c]=[]}}else{var d=bookacti_localized.error_retrieve_exceptions;if(e.error==="not_allowed"){d+="\n"+bookacti_localized.error_not_allowed}console.log(e);alert(d)}}$j("#bookacti-template-calendar").fullCalendar("rerenderEvents")},error:function(d){alert("AJAX "+bookacti_localized.error_retrieve_exceptions);console.log(d)},complete:function(){bookacti_stop_template_loading()}})}function bookacti_is_locked_event(b){var a=false;$j.each(lockedEvents,function(d,c){if(parseInt(b)===parseInt(c)){a=true;return false}});return a}function bookacti_unbind_occurrences(b,a){bookacti_start_template_loading();$j.ajax({url:ajaxurl,data:{action:"bookactiUnbindOccurences",unbind:a,event_id:b.id,event_start:b.start.format("YYYY-MM-DD HH:mm:ss"),event_end:b.end.format("YYYY-MM-DD HH:mm:ss"),interval:bookacti.booking_system["bookacti-template-calendar"]["events_interval"],nonce:bookacti_localized.nonce_unbind_occurences},type:"POST",dataType:"json",success:function(d){if(d.status==="success"){var e=d.new_event_id;bookacti_unselect_event(b,undefined,true);bookacti.booking_system["bookacti-template-calendar"]["exceptions"]=d.exceptions;bookacti.booking_system["bookacti-template-calendar"]["groups_events"]=d.groups_events;bookacti.booking_system["bookacti-template-calendar"]["events_data"][e]=d.events_data[e];if(typeof d.events_data[b.id]!=="undefined"){bookacti.booking_system["bookacti-template-calendar"]["events_data"][b.id]=d.events_data[b.id]}if(a==="booked"){$j("#bookacti-template-calendar").fullCalendar("removeEvents",b.id)}$j("#bookacti-template-calendar").fullCalendar("addEventSource",d.events)}else{var c=bookacti_localized.error_unbind_occurences;if(d.error==="not_allowed"){c+="\n"+bookacti_localized.error_not_allowed}alert(c)}},error:function(c){alert("AJAX "+bookacti_localized.error_unbind_occurences);console.log(c)},complete:function(){bookacti_stop_template_loading()}});$j("#bookacti-unbind-booked-event-dialog").dialog("close")}function bookacti_start_template_loading(){if(bookacti.booking_system["bookacti-template-calendar"]["loading_number"]===0){bookacti_enter_template_loading_state()}bookacti.booking_system["bookacti-template-calendar"]["loading_number"]++}function bookacti_stop_template_loading(){bookacti.booking_system["bookacti-template-calendar"]["loading_number"]--;bookacti.booking_system["bookacti-template-calendar"]["loading_number"]=Math.max(bookacti.booking_system["bookacti-template-calendar"]["loading_number"],0);if(bookacti.booking_system["bookacti-template-calendar"]["loading_number"]===0){bookacti_exit_template_loading_state()}}function bookacti_enter_template_loading_state(){var a='<div class="bookacti-loading-alt"><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /><span class="bookacti-loading-alt-text" >'+bookacti_localized.loading+"</span></div>";if(!$j.isNumeric(bookacti.booking_system["bookacti-template-calendar"]["loading_number"])){bookacti.booking_system["bookacti-template-calendar"]["loading_number"]=0}if($j("#bookacti-template-calendar").find(".fc-view-container").length){if(bookacti.booking_system["bookacti-template-calendar"]["loading_number"]===0||!$j("#bookacti-template-calendar").find(".bookacti-loading-overlay").length){$j("#bookacti-template-calendar").find(".bookacti-loading-alt").remove();bookacti_enter_calendar_loading_state($j("#bookacti-template-calendar"))}}else{if(!$j("#bookacti-template-calendar").find(".bookacti-loading-alt").length){$j("#bookacti-template-calendar").append(a)}}bookacti.blocked_events=true;$j("#bookacti-template-sidebar img").addClass("bookacti-disabled-img");$j(".bookacti-template-dialogs").find("input, select, button").attr("disabled",true);$j("#bookacti-template-picker").attr("disabled",true);$j("#bookacti-template-calendar").fullCalendar("rerenderEvents")}function bookacti_exit_template_loading_state(a){a=a||false;if(a){bookacti.booking_system["bookacti-template-calendar"]["loading_number"]=0}bookacti_exit_calendar_loading_state($j("#bookacti-template-calendar"));$j("#bookacti-template-calendar").find(".bookacti-loading-alt").remove();bookacti.blocked_events=false;$j("#bookacti-template-sidebar img").removeClass("bookacti-disabled-img");$j(".bookacti-template-dialogs").find("input, select, button").attr("disabled",false);$j("#bookacti-template-picker").attr("disabled",false);$j("#bookacti-template-calendar").fullCalendar("rerenderEvents")}function bookacti_display_activity_tuto_if_no_activity_available(){if($j("#bookacti-template-first-activity-container").length){if(!$j(".activity-row").length){$j("#bookacti-template-first-activity-container").show()}else{$j("#bookacti-template-first-activity-container").hide()}}}function bookacti_maybe_display_add_group_of_events_button(){if($j("#bookacti-template-add-first-group-of-events-container").length){if(bookacti.booking_system["bookacti-template-calendar"]["selected_events"].length>=2){$j("#bookacti-insert-group-of-events").css("visibility","visible");if(!$j(".bookacti-group-category").length){$j("#bookacti-template-add-group-of-events-tuto-select-events").hide();$j("#bookacti-template-add-first-group-of-events-container").show()}}else{$j("#bookacti-template-add-first-group-of-events-container").hide();$j("#bookacti-insert-group-of-events").css("visibility","hidden");if(!$j(".bookacti-group-category").length){$j("#bookacti-template-add-group-of-events-tuto-select-events").show()}}}}function bookacti_expand_collapse_groups_of_events(c,d,a){a=a?true:false;d=$j.inArray(d,["expand","collapse"])!==-1?d:false;var b=$j('.bookacti-group-category[data-group-category-id="'+c+'"]').data("show-groups");if((b||d==="collapse")&&d!=="expand"){$j('.bookacti-group-category[data-group-category-id="'+c+'"]').attr("data-show-groups",0);$j('.bookacti-group-category[data-group-category-id="'+c+'"]').data("show-groups",0);$j('.bookacti-group-category[data-group-category-id="'+c+'"] .bookacti-groups-of-events-list').hide(200)}else{if((!b||d==="expand")&&d!=="collapse"){if(a){bookacti_expand_collapse_all_groups_of_events("collapse",c)}$j('.bookacti-group-category[data-group-category-id="'+c+'"]').attr("data-show-groups",1);$j('.bookacti-group-category[data-group-category-id="'+c+'"]').data("show-groups",1);$j('.bookacti-group-category[data-group-category-id="'+c+'"] .bookacti-groups-of-events-list').show(200)}}}function bookacti_expand_collapse_all_groups_of_events(c,b){b=b?b:false;var a=".bookacti-group-category";if(b){if($j.isArray(b)){$j.each(b,function(e,d){a+=':not([data-group-category-id="'+d+'"])'})}else{a='.bookacti-group-category:not([data-group-category-id="'+b+'"])'}}if(c==="collapse"){$j(a).attr("data-show-groups",0);$j(a).data("show-groups",0);$j(a+" .bookacti-groups-of-events-list").hide(200)}else{if(c==="expand"){$j(a).attr("data-show-groups",1);$j(a).data("show-groups",1);$j(a+" .bookacti-groups-of-events-list").show(200)}}}function bookacti_load_activities_bound_to_template(a){if(parseInt(a)!==parseInt(bookacti.selected_template)){$j("#bookacti-activities-bound-to-template .form-error").remove();bookacti_start_template_loading();$j.ajax({url:ajaxurl,data:{action:"bookactiGetActivitiesByTemplate",selected_template_id:a,current_template_id:bookacti.selected_template,nonce:bookacti_localized.nonce_get_activities_by_template},type:"POST",dataType:"json",success:function(d){$j("select#activities-to-import").empty();if(d.status==="success"){var c="";$j.each(d.activities,function(e,f){if(!$j('#bookacti-template-activity-list .activity-row .fc-event[data-activity-id="'+e+'"]').length){c+='<option value="'+e+'" >'+f.title+"</option>"}});if(c!==""){$j("select#activities-to-import").append(c)}else{$j("#bookacti-activities-bound-to-template").append('<div class="form-error">'+bookacti_localized.error_no_avail_activity_bound+"</div>")}}else{if(d.status==="no_activity"){$j("#bookacti-activities-bound-to-template").append('<div class="form-error">'+bookacti_localized.error_no_avail_activity_bound+"</div>")}else{var b=bookacti_localized.error_retrieve_activity_bound;if(d.error==="not_allowed"){b+="\n"+bookacti_localized.error_not_allowed}console.log(d);alert(b)}}},error:function(b){alert("AJAX "+bookacti_localized.error_retrieve_activity_bound);console.log(b)},complete:function(){bookacti_stop_template_loading()}})}}function bookacti_show_event_actions(a){a.addClass("bookacti-event-over");a.find(".bookacti-event-action").show()}function bookacti_hide_event_actions(a,b){a.removeClass("bookacti-event-over");a.find('.bookacti-event-action[data-hide-on-mouseout="1"]').hide();var c=false;$j.each(bookacti.booking_system["bookacti-template-calendar"]["selected_events"],function(e,d){if(d.id==b.id&&d.start.substr(0,10)===b.start.format("YYYY-MM-DD")){c=true;return false}});if(c){a.find(".bookacti-event-actions").show();a.find(".bookacti-event-action-select").show()}else{a.find(".bookacti-event-action-select").hide()}};